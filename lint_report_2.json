[{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\drizzle.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\actions.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2151,2154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2151,2154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2164,2167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2164,2167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\chat\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2384,2387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2384,2387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":58,"column":26,"severity":1,"nodeType":null,"fix":{"range":[2391,2453],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2262,2265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2262,2265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { groq } from '@ai-sdk/groq';\r\nimport { streamText } from 'ai';\r\n\r\n// Allow streaming responses up to 30 seconds\r\nexport const maxDuration = 30;\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const { messages } = await req.json();\r\n\r\n    console.log('Chat request with', messages.length, 'messages');\r\n\r\n    const result = await streamText({\r\n      model: groq('meta-llama/llama-4-scout-17b-16e-instruct'),\r\n      system: `You are an event planner helping users find hotels and restaurants near events.\r\n\r\nCRITICAL RULES:\r\n1. For greetings (hi, hello), respond normally.\r\n1. For greetings (hi, hello), respond normally.\r\n2. When user mentions an artist/event they want to see, IMMEDIATELY response with \"Searching for events...\" and include EXACTLY this format:\r\n   [SEARCH_EVENT: name]\r\n   \r\n   examples:\r\n   User: \"Drake\" -> [SEARCH_EVENT: Drake]\r\n   User: \"Taylor Swift\" -> [SEARCH_EVENT: Taylor Swift]\r\n   \r\n   NEVER use other formats like [Drake_Event] or [DRAW_Event].\r\n\r\n3. **EVENT SELECTION Handling**:\r\n   When user says \"I want to attend: [Event Name]...\", DO NOT ask what event they want. You already know.\r\n   IMMEDIATELY response: \"Great choice! [ASK_HOTELS] Would you like to look for hotels or restaurants nearby?\"\r\n   \r\n   CRITICAL: You MUST include [ASK_HOTELS] in the response. This triggers the hotel search buttons.\r\n\r\n4. **HOTEL SEARCH Trigger**:\r\n   When user asks for hotels or gives hotel preferences, include this trigger:\r\n   [FIND_PLACES: type=hotel | budget=cheap | rating=4 | radius=8000]\r\n\r\n   - budget: cheap, moderate, expensive\r\n   - rating: 0-5\r\n   - radius: 800 (walking), 1600 (nearby), 8000 (driving)\r\n\r\n5. **RESTAURANT SEARCH Trigger**:\r\n   When user asks for restaurants, FIRST ask: \"Should they be near the venue or near your hotel?\" unless already specified.\r\n   Then ask for cuisine/budget.\r\n   When preferences given:\r\n   [FIND_PLACES: type=restaurant | budget=moderate | rating=4 | radius=1600]\r\n\r\nIMPORTANT:\r\n- NEVER ask \"what event\" after the user just selected one.\r\n- You can search for restaurants OR hotels in any order.\r\n- ALWAYS include [FIND_PLACES: ...] when preferences are given.`,\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      messages: messages.map((m: any) => ({ role: m.role, content: m.content })),\r\n    });\r\n\r\n    return result.toTextStreamResponse();\r\n  } catch (error: any) { // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    console.error('API ROUTE ERROR:', error);\r\n    return new Response(JSON.stringify({ error: 'Internal Server Error' }), { status: 500 });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\distance\\route.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1570,1573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1570,1573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\events\\route.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1968,1971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1968,1971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\hotels\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6189,6192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6189,6192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":148,"column":28,"severity":1,"nodeType":null,"fix":{"range":[6196,6258],"text":" "}}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3175,3178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3175,3178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4173,4176],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4173,4176],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4905,4908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4905,4908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { NextRequest, NextResponse } from 'next/server';\r\n\r\n// Cache token to avoid re-authenticating every request\r\nlet cachedToken: { token: string; expiresAt: number } | null = null;\r\n\r\nasync function getAmadeusToken(): Promise<string> {\r\n    // Check if we have a valid cached token\r\n    if (cachedToken && cachedToken.expiresAt > Date.now()) {\r\n        return cachedToken.token;\r\n    }\r\n\r\n    const apiKey = process.env.AMADEUS_API_KEY;\r\n    const apiSecret = process.env.AMADEUS_API_SECRET;\r\n\r\n    if (!apiKey || !apiSecret) {\r\n        throw new Error('Amadeus API credentials not configured');\r\n    }\r\n\r\n    const response = await fetch('https://test.api.amadeus.com/v1/security/oauth2/token', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n        },\r\n        body: new URLSearchParams({\r\n            grant_type: 'client_credentials',\r\n            client_id: apiKey,\r\n            client_secret: apiSecret,\r\n        }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n        const error = await response.text();\r\n        console.error('Amadeus auth error:', error);\r\n        throw new Error('Failed to authenticate with Amadeus');\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    // Cache the token (expires in ~30 minutes, we'll refresh at 25)\r\n    cachedToken = {\r\n        token: data.access_token,\r\n        expiresAt: Date.now() + (data.expires_in - 300) * 1000, // Refresh 5 min early\r\n    };\r\n\r\n    return data.access_token;\r\n}\r\n\r\nexport async function GET(req: NextRequest) {\r\n    const searchParams = req.nextUrl.searchParams;\r\n    const lat = searchParams.get('lat');\r\n    const lng = searchParams.get('lng');\r\n    const checkIn = searchParams.get('checkIn') || getDefaultCheckIn();\r\n    const checkOut = searchParams.get('checkOut') || getDefaultCheckOut();\r\n    const radiusInMeters = parseInt(searchParams.get('radius') || '5000');\r\n    // Force larger radius in test environment to find hotels (min 20km)\r\n    const radius = Math.max(20, Math.ceil(radiusInMeters / 1000));\r\n    const adults = searchParams.get('adults') || '1';\r\n\r\n    if (!lat || !lng) {\r\n        return NextResponse.json({ error: 'Missing lat/lng parameters' }, { status: 400 });\r\n    }\r\n\r\n    try {\r\n        const token = await getAmadeusToken();\r\n\r\n        // First, get hotel list by location\r\n        const hotelsUrl = `https://test.api.amadeus.com/v1/reference-data/locations/hotels/by-geocode?latitude=${lat}&longitude=${lng}&radius=${radius}&radiusUnit=KM&hotelSource=ALL`;\r\n\r\n        console.log('Fetching hotels by location...');\r\n        const hotelsResponse = await fetch(hotelsUrl, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        if (!hotelsResponse.ok) {\r\n            const error = await hotelsResponse.text();\r\n            console.error('Hotels list error:', error);\r\n            return NextResponse.json({ error: 'Failed to fetch hotels list' }, { status: 500 });\r\n        }\r\n\r\n        const hotelsData = await hotelsResponse.json();\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        const hotelIds = hotelsData.data?.slice(0, 10).map((h: any) => h.hotelId) || [];\r\n\r\n        if (hotelIds.length === 0) {\r\n            return NextResponse.json({ hotels: [], message: 'No hotels found in this area' });\r\n        }\r\n\r\n        // Get hotel offers (prices) for these hotels\r\n        const offersUrl = `https://test.api.amadeus.com/v3/shopping/hotel-offers?hotelIds=${hotelIds.join(',')}&adults=${adults}&checkInDate=${checkIn}&checkOutDate=${checkOut}&currency=USD`;\r\n\r\n        console.log('Fetching hotel offers...');\r\n        const offersResponse = await fetch(offersUrl, {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        if (!offersResponse.ok) {\r\n            const error = await offersResponse.text();\r\n            console.error('Hotel offers error:', error);\r\n            // Return hotels without prices if offers fail\r\n            return NextResponse.json({\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                hotels: hotelsData.data.slice(0, 10).map((h: any) => ({\r\n                    id: h.hotelId,\r\n                    name: h.name,\r\n                    address: h.address?.countryCode || '',\r\n                    location: { lat: h.geoCode?.latitude, lng: h.geoCode?.longitude },\r\n                    price: null,\r\n                    priceLabel: 'Price unavailable',\r\n                    rating: null,\r\n                })),\r\n            });\r\n        }\r\n\r\n        const offersData = await offersResponse.json();\r\n\r\n        console.log('Hotel offers data sample:', JSON.stringify(offersData.data?.[0], null, 2));\r\n\r\n        // Transform to our format\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        const hotels = (offersData.data || []).map((hotel: any) => {\r\n            const offer = hotel.offers?.[0];\r\n            const price = offer?.price?.total;\r\n            // Amadeus returns star rating (1-5), not user ratings\r\n            const starRating = hotel.hotel?.rating ? parseInt(hotel.hotel.rating) : null;\r\n\r\n            return {\r\n                id: hotel.hotel?.hotelId,\r\n                name: hotel.hotel?.name,\r\n                address: hotel.hotel?.address?.lines?.join(', ') || '',\r\n                city: hotel.hotel?.address?.cityName || '',\r\n                location: {\r\n                    lat: hotel.hotel?.latitude,\r\n                    lng: hotel.hotel?.longitude,\r\n                },\r\n                price: price ? parseFloat(price) : null,\r\n                priceLabel: price ? `$${parseFloat(price).toFixed(0)}/night` : 'Price N/A',\r\n                currency: offer?.price?.currency || 'USD',\r\n                rating: starRating, // This is star rating (1-5), not user review rating\r\n                starRating: starRating,\r\n                amenities: hotel.hotel?.amenities?.slice(0, 5) || [],\r\n                roomType: offer?.room?.description?.text || '',\r\n                checkIn,\r\n                checkOut,\r\n            };\r\n        });\r\n\r\n        return NextResponse.json({ hotels });\r\n    } catch (error: any) { // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        console.error('Error fetching hotels:', error);\r\n        return NextResponse.json({ error: error.message || 'Internal server error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nfunction getDefaultCheckIn(): string {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() + 7); // 1 week from now\r\n    return date.toISOString().split('T')[0];\r\n}\r\n\r\nfunction getDefaultCheckOut(): string {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() + 8); // 1 week + 1 day\r\n    return date.toISOString().split('T')[0];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\api\\places\\route.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from '@typescript-eslint/no-explicit-any').","line":49,"column":9,"severity":1,"nodeType":null,"fix":{"range":[1993,2055],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2130,2133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2130,2133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2698,2701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2698,2701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function GET(req: NextRequest) {\r\n    const searchParams = req.nextUrl.searchParams;\r\n    const lat = searchParams.get('lat');\r\n    const lng = searchParams.get('lng');\r\n    const type = searchParams.get('type') || 'restaurant'; // restaurant, lodging\r\n    const radius = searchParams.get('radius') || '1500'; // meters\r\n    const minRating = parseFloat(searchParams.get('minRating') || '0');\r\n    const maxPrice = parseInt(searchParams.get('maxPrice') || '4'); // 1-4 scale\r\n\r\n    const keyword = searchParams.get('keyword') || '';\r\n\r\n    if (!lat || !lng) {\r\n        return NextResponse.json({ error: 'Missing lat/lng parameters' }, { status: 400 });\r\n    }\r\n\r\n    const apiKey = process.env.GOOGLE_API_KEY;\r\n    if (!apiKey) {\r\n        return NextResponse.json({ error: 'Google API key not configured' }, { status: 500 });\r\n    }\r\n\r\n    try {\r\n        // Use Google Places Nearby Search\r\n        let url = `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${lat},${lng}&radius=${radius}&type=${type}&key=${apiKey}`;\r\n\r\n        if (keyword) {\r\n            url += `&keyword=${encodeURIComponent(keyword)}`;\r\n        }\r\n\r\n        console.log('Places API request URL:', url.replace(apiKey, 'API_KEY_HIDDEN'));\r\n\r\n        const response = await fetch(url);\r\n        const data = await response.json();\r\n\r\n        console.log('Places API response status:', data.status);\r\n        console.log('Places API results count:', data.results?.length || 0);\r\n\r\n        if (data.status !== 'OK' && data.status !== 'ZERO_RESULTS') {\r\n            console.error('Google Places API error:', JSON.stringify(data, null, 2));\r\n            return NextResponse.json({\r\n                error: `Places API error: ${data.status}`,\r\n                message: data.error_message || 'Unknown error',\r\n                details: data\r\n            }, { status: 500 });\r\n        }\r\n\r\n        // Filter and transform results\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        const places = (data.results || [])\r\n            .filter((place: any) => {\r\n                // Filter by rating\r\n                if (minRating > 0 && (!place.rating || place.rating < minRating)) {\r\n                    return false;\r\n                }\r\n                // Filter by price level\r\n                if (place.price_level !== undefined && place.price_level > maxPrice) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            })\r\n            .slice(0, 10) // Limit to 10 results\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            .map((place: any) => ({\r\n                id: place.place_id,\r\n                name: place.name,\r\n                address: place.vicinity,\r\n                rating: place.rating || 0,\r\n                userRatingsTotal: place.user_ratings_total || 0,\r\n                priceLevel: place.price_level, // 0-4\r\n                priceLabel: getPriceLabel(place.price_level),\r\n                types: place.types,\r\n                location: {\r\n                    lat: place.geometry.location.lat,\r\n                    lng: place.geometry.location.lng,\r\n                },\r\n                photo: place.photos?.[0]?.photo_reference\r\n                    ? `https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photo_reference=${place.photos[0].photo_reference}&key=${apiKey}`\r\n                    : null,\r\n                openNow: place.opening_hours?.open_now,\r\n            }));\r\n\r\n        return NextResponse.json({ places });\r\n    } catch (error) {\r\n        console.error('Error fetching places:', error);\r\n        return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n    }\r\n}\r\n\r\nfunction getPriceLabel(priceLevel: number | undefined): string {\r\n    switch (priceLevel) {\r\n        case 0: return 'Free';\r\n        case 1: return '$';\r\n        case 2: return '$$';\r\n        case 3: return '$$$';\r\n        case 4: return '$$$$';\r\n        default: return 'Price N/A';\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\page.tsx:21:13\n  19 |         if (savedTheme === 'dark' || (!savedTheme && systemDark)) {\n  20 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 21 |             setIsDarkMode(true);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |             document.documentElement.classList.add('dark');\n  23 |         } else {\n  24 |             setIsDarkMode(false);","line":21,"column":13,"nodeType":null,"endLine":21,"endColumn":26,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\app\\page.tsx:46:9\n  44 |         // Initialize or load session\n  45 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 46 |         setSessionId(crypto.randomUUID());\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  47 |     }, []);\n  48 |\n  49 |     const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);","line":46,"column":9,"nodeType":null,"endLine":46,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'credentials' is defined but never used.","line":26,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport NextAuth from \"next-auth\"\r\nimport Google from \"next-auth/providers/google\"\r\nimport Credentials from \"next-auth/providers/credentials\"\r\nimport { DrizzleAdapter } from \"@auth/drizzle-adapter\"\r\nimport { db } from \"./db\"\r\nimport { users } from \"./db/schema\"\r\nimport { eq } from \"drizzle-orm\"\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n    adapter: DrizzleAdapter(db),\r\n    session: { strategy: \"jwt\" }, // Required for Credentials provider integration with Adapter\r\n    providers: [\r\n        Google({\r\n            authorization: {\r\n                params: {\r\n                    prompt: \"consent\",\r\n                    access_type: \"offline\",\r\n                    response_type: \"code\"\r\n                }\r\n            }\r\n        }),\r\n        Credentials({\r\n            name: \"Debug User\",\r\n            credentials: {},\r\n            authorize: async (credentials) => {\r\n                const debugUser = {\r\n                    id: \"debug-user-id\",\r\n                    name: \"Debug User\",\r\n                    email: \"debug@example.com\",\r\n                    image: \"\",\r\n                }\r\n\r\n                // Upsert Debug User to DB so foreign keys work\r\n                try {\r\n                    const existing = await db.select().from(users).where(eq(users.id, debugUser.id)).limit(1)\r\n                    if (existing.length === 0) {\r\n                        await db.insert(users).values(debugUser)\r\n                    }\r\n\r\n                    // SEED DATA: Check if any chats exist for debug user, if not, create one\r\n                    const { chats, messages } = await import(\"./db/schema\");\r\n                    const existingChats = await db.select().from(chats).where(eq(chats.userId, debugUser.id)).limit(1);\r\n\r\n                    if (existingChats.length === 0) {\r\n                        const chatId = crypto.randomUUID();\r\n                        await db.insert(chats).values({\r\n                            id: chatId,\r\n                            userId: debugUser.id,\r\n                            title: \"Welcome to Gopher (Debug)\",\r\n                            isPinned: true,\r\n                            createdAt: new Date(),\r\n                            updatedAt: new Date(),\r\n                        });\r\n\r\n                        await db.insert(messages).values({\r\n                            id: crypto.randomUUID(),\r\n                            chatId: chatId,\r\n                            role: 'assistant',\r\n                            content: \"Hello! This is a pre-seeded chat for the Debug User. You can test features here.\",\r\n                            createdAt: new Date(),\r\n                        });\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Failed to upsert debug user or seed data\", e)\r\n                }\r\n\r\n                return debugUser\r\n            },\r\n        }),\r\n    ],\r\n    callbacks: {\r\n        session({ session, token }) {\r\n            if (token.sub && session.user) {\r\n                session.user.id = token.sub\r\n            }\r\n            return session\r\n        }\r\n    }\r\n})\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\AnimatedDiamondGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\AuthProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\Chat.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isHotelsExpanded' is assigned a value but never used.","line":100,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":100,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":402,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":402,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16217,16220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16217,16220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":57,"column":13,"nodeType":"JSXOpeningElement","endLine":62,"endColumn":15,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10330,10333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10330,10333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'saveSessionData'. Either include it or remove the dependency array.","line":301,"column":8,"nodeType":"ArrayExpression","endLine":301,"endColumn":75,"suggestions":[{"desc":"Update the dependencies array to be: [messages, chatTitle, itinerary, schedule, selectedEvent, isLoaded, saveSessionData]","fix":{"range":[12109,12176],"text":"[messages, chatTitle, itinerary, schedule, selectedEvent, isLoaded, saveSessionData]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14967,14970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14967,14970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1124,"column":45,"nodeType":"JSXOpeningElement","endLine":1124,"endColumn":132,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":1189,"column":53,"nodeType":"JSXOpeningElement","endLine":1189,"endColumn":140,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef, useEffect, useMemo } from 'react';\r\nimport { useSession } from \"next-auth/react\"\r\nimport { getChat, saveChat } from \"@/app/actions\"\r\nimport MapView from './MapView';\r\n\r\ninterface Event {\r\n    id: string;\r\n    name: string;\r\n    date: string;\r\n    time: string;\r\n    venue: string;\r\n    city: string;\r\n    state: string;\r\n    image: string;\r\n    url: string;\r\n    priceRange: string;\r\n    location?: { lat: number; lng: number } | null;\r\n}\r\n\r\ninterface Place {\r\n    id: string;\r\n    name: string;\r\n    address: string;\r\n    rating: number;\r\n    userRatingsTotal: number;\r\n    priceLevel?: number;\r\n    priceLabel: string;\r\n    types: string[];\r\n    location: { lat: number; lng: number };\r\n    photo: string | null;\r\n    openNow?: boolean;\r\n    distance?: string;\r\n}\r\n\r\nconst getPlaceEmoji = (types: string[] = []) => {\r\n    if (!types) return 'ðŸ“';\r\n    if (types.includes('lodging') || types.includes('hotel')) return 'ðŸ¨';\r\n    if (types.includes('restaurant') || types.includes('food') || types.includes('meal_takeaway') || types.includes('cafe')) return 'ðŸ½ï¸';\r\n    if (types.includes('park') || types.includes('campground') || types.includes('natural_feature')) return 'ðŸŒ³';\r\n    if (types.includes('movie_theater') || types.includes('cinema')) return 'ðŸŽ¬';\r\n    if (types.includes('museum') || types.includes('art_gallery')) return 'ðŸ–¼ï¸';\r\n    if (types.includes('shopping_mall') || types.includes('store') || types.includes('clothing_store')) return 'ðŸ›ï¸';\r\n    if (types.includes('night_club') || types.includes('bar')) return 'ðŸ¸';\r\n    if (types.includes('spa') || types.includes('gym') || types.includes('health')) return 'ðŸ’†';\r\n    if (types.includes('tourist_attraction')) return 'ðŸ“¸';\r\n    return 'ðŸ“';\r\n};\r\n\r\nconst PlaceImage = ({ place }: { place: Place }) => {\r\n    const [imgError, setImgError] = useState(false);\r\n\r\n    if (place.photo && !imgError) {\r\n        return (\r\n            /* eslint-disable-next-line @next/next/no-img-element */\r\n            <img\r\n                src={place.photo}\r\n                alt={place.name}\r\n                className=\"w-full sm:w-32 h-32 object-cover\"\r\n                onError={() => setImgError(true)}\r\n            />\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"w-full sm:w-32 h-32 bg-gray-200 flex items-center justify-center text-4xl\">\r\n            {getPlaceEmoji(place.types)}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\ninterface ChatProps {\r\n    sessionId: string;\r\n    isSidebarOpen: boolean;\r\n    isDarkMode: boolean;\r\n    openScheduleTrigger?: number;\r\n}\r\n\r\nexport default function Chat({ sessionId, isSidebarOpen, isDarkMode, openScheduleTrigger }: ChatProps) {\r\n    const [messages, setMessages] = useState<Array<{ role: string, content: string }>>([]);\r\n    const [input, setInput] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [events, setEvents] = useState<Event[]>([]);\r\n    const [isSearchingEvents, setIsSearchingEvents] = useState(false);\r\n    const [hasSearchedEvents, setHasSearchedEvents] = useState(false);\r\n    const [selectedEvent, setSelectedEvent] = useState<Event | null>(null);\r\n\r\n    // Separate Results States\r\n    const [hotelResults, setHotelResults] = useState<Place[]>([]);\r\n    const [restaurantResults, setRestaurantResults] = useState<Place[]>([]);\r\n    const [exploreResults, setExploreResults] = useState<Place[]>([]);\r\n\r\n    const [selectedPlace, setSelectedPlace] = useState<Place | null>(null);\r\n    const [isSearchingPlaces, setIsSearchingPlaces] = useState(false);\r\n\r\n    // UI State for Collapsible Sections\r\n    const [isHotelsExpanded, setIsHotelsExpanded] = useState(true);\r\n\r\n    // Updated States for Advanced Filters\r\n    const [waitingForConfirmation, setWaitingForConfirmation] = useState<'event' | 'hotels' | 'hotels_filters' | 'food' | 'food_filters' | 'explore' | 'explore_filters' | null>(null);\r\n    const [hasSearchedPlaces, setHasSearchedPlaces] = useState(false);\r\n    const [hotelFilters, setHotelFilters] = useState({ radius: 8000 });\r\n    const [foodFilters, setFoodFilters] = useState({\r\n        locationPreference: 'venue' as 'venue' | 'hotel',\r\n        radius: 8000,\r\n        cuisine: ''\r\n    });\r\n    const [exploreFilters, setExploreFilters] = useState({\r\n        locationPreference: 'venue' as 'venue' | 'hotel',\r\n        radius: 8000,\r\n        activity: ''\r\n    });\r\n\r\n    // Itinerary state - moved here to be available in save functions\r\n    const [itinerary, setItinerary] = useState<Array<Event | Place>>([]);\r\n    const [schedule, setSchedule] = useState<Array<{ time: string, activity: string, description: string }>>([]);\r\n    const [isScheduleOpen, setIsScheduleOpen] = useState(false);\r\n\r\n    // Track if this chat has been confirmed with an event name\r\n    const [chatTitle, setChatTitle] = useState<string | null>(null);\r\n    // Track if initial load is complete to prevent overwriting DB with empty state\r\n    const [isLoaded, setIsLoaded] = useState(false);\r\n    // Track if user has modified state to preventing saving on load\r\n    const isDirtyRef = useRef(false);\r\n\r\n\r\n    // --- Effect: Open Schedule from Sidebar Trigger ---\r\n    useEffect(() => {\r\n        if (openScheduleTrigger && openScheduleTrigger > 0) {\r\n            setIsScheduleOpen(true);\r\n        }\r\n    }, [openScheduleTrigger]);\r\n\r\n    // --- Session Management ---\r\n    const { data: session, status } = useSession();\r\n\r\n    useEffect(() => {\r\n        // Load messages for this session\r\n        const load = async () => {\r\n            if (session?.user) {\r\n                const dbChat = await getChat(sessionId);\r\n                if (dbChat) {\r\n                    console.log('Loading chat from DB:', dbChat);\r\n\r\n                    // Restore Context\r\n                    if (dbChat.events) setEvents(dbChat.events);\r\n                    if (dbChat.itinerary) setItinerary(dbChat.itinerary);\r\n                    if (dbChat.schedule) setSchedule(dbChat.schedule);\r\n                    if (dbChat.selectedEvent) setSelectedEvent(dbChat.selectedEvent);\r\n                    if (dbChat.title) setChatTitle(dbChat.title);\r\n\r\n                    // Generate Welcome Back Message based on context\r\n                    if (dbChat.title) {\r\n                        setMessages([{\r\n                            role: 'assistant',\r\n                            content: `Welcome back! I've loaded your itinerary for **${dbChat.title}**. You can add more hotels, find food, or generate your schedule.`\r\n                        }]);\r\n                    } else {\r\n                        // Should not happen for confirmed chats, but fallback\r\n                        setMessages([]);\r\n                    }\r\n                    setIsLoaded(true);\r\n                } else {\r\n                    // DB chat not found - treat as new\r\n                    resetState();\r\n                    setIsLoaded(true); // Ready to save new stuff\r\n                }\r\n            } else {\r\n                // LocalStorage Fallback\r\n                const savedData = localStorage.getItem(`chat_session_${sessionId}`);\r\n                if (savedData) {\r\n                    try {\r\n                        const parsed = JSON.parse(savedData);\r\n                        if (parsed.events) setEvents(parsed.events);\r\n                        if (parsed.itinerary) setItinerary(parsed.itinerary);\r\n                        if (parsed.schedule) setSchedule(parsed.schedule);\r\n                        if (parsed.selectedEvent) setSelectedEvent(parsed.selectedEvent);\r\n                        if (parsed.preview) setChatTitle(parsed.preview);\r\n\r\n                        // If it has a title, it's a confirmed chat. Generate fresh context if needed/wanted.\r\n                        // For local storage, user might want history?\r\n                        // Current logic: persist history in localStorage?\r\n                        // The 'saveSessionLocal' saves 'messages'.\r\n                        // Let's load them if they exist for continuity in guest mode\r\n                        if (parsed.messages && parsed.messages.length > 0) {\r\n                            setMessages(parsed.messages);\r\n                        } else if (parsed.preview) {\r\n                            setMessages([{\r\n                                role: 'assistant',\r\n                                content: `Welcome back! I've loaded your itinerary for **${parsed.preview}**.`\r\n                            }]);\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('Failed to parse local session', e);\r\n                    }\r\n                } else {\r\n                    resetState();\r\n                }\r\n                setIsLoaded(true);\r\n            }\r\n        };\r\n\r\n        if (status !== 'loading') {\r\n            load();\r\n        }\r\n\r\n    }, [sessionId, session, status]); // Reload if session changes (login)\r\n\r\n\r\n\r\n    const resetState = () => {\r\n        setMessages([]);\r\n        setEvents([]);\r\n        setItinerary([]);\r\n        setSchedule([]);\r\n        setHotelResults([]);\r\n        setRestaurantResults([]);\r\n        setExploreResults([]);\r\n        setSelectedEvent(null);\r\n        setSelectedPlace(null);\r\n        setWaitingForConfirmation(null);\r\n        setHasSearchedEvents(false);\r\n        setHasSearchedPlaces(false);\r\n        setIsHotelsExpanded(true);\r\n        setInput('');\r\n        setChatTitle(null);\r\n    }\r\n\r\n    const saveSessionData = async (msgs: Array<{ role: string, content: string }>, eventName?: string) => {\r\n        // Use provided eventName or existing chatTitle\r\n        const titleToUse = eventName || chatTitle;\r\n\r\n        // ONLY save if we have a title (event was confirmed)\r\n        if (!titleToUse) return;\r\n\r\n        // Update chatTitle state if a new event name is provided\r\n        if (eventName && eventName !== chatTitle) {\r\n            setChatTitle(eventName);\r\n        }\r\n\r\n        console.log('Saving chat:', { sessionId, titleToUse, messageCount: msgs.length, msgs });\r\n\r\n        // User requested NOT to save conversation history, only context.\r\n        // We pass empty array for messages to saveChat/saveSessionLocal so history is not persisted causing a \"fresh\" start on reload.\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        const messagesToSave: any[] = [];\r\n\r\n        // DB Save\r\n        if (session?.user) {\r\n            const metaData = {\r\n                events,\r\n                itinerary,\r\n                schedule,\r\n                selectedEvent\r\n            };\r\n            const result = await saveChat(sessionId, titleToUse, messagesToSave, metaData);\r\n            console.log('DB save result:', result);\r\n        } else {\r\n            // LocalStorage Save\r\n            saveSessionLocal(messagesToSave, titleToUse);\r\n        }\r\n\r\n        // Trigger sidebar refresh\r\n        window.dispatchEvent(new Event('storage'));\r\n    };\r\n\r\n    const saveSessionLocal = (msgs: Array<{ role: string, content: string }>, eventName: string) => {\r\n        // ONLY save if we have an event name\r\n        if (!eventName) return;\r\n\r\n        const existingDataStr = localStorage.getItem(`chat_session_${sessionId}`);\r\n        const existingData = existingDataStr ? JSON.parse(existingDataStr) : {};\r\n\r\n        // Preserve Pinned State if exists\r\n        const isPinned = existingData.isPinned || false;\r\n\r\n        const data = {\r\n            id: sessionId,\r\n            messages: msgs,\r\n            events,\r\n            itinerary,\r\n            schedule,\r\n            selectedEvent,\r\n            preview: eventName,\r\n            isPinned: isPinned,\r\n            timestamp: Date.now()\r\n        };\r\n\r\n        localStorage.setItem(`chat_session_${sessionId}`, JSON.stringify(data));\r\n    };\r\n\r\n    // Auto-save messages ONLY if chat is confirmed (has a title) AND fully loaded AND user has interacted (dirty)\r\n    useEffect(() => {\r\n        if (isLoaded && chatTitle && messages.length > 0 && isDirtyRef.current) {\r\n            saveSessionData(messages);\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [messages, chatTitle, itinerary, schedule, selectedEvent, isLoaded]);\r\n\r\n    const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n    };\r\n\r\n    useEffect(() => {\r\n        scrollToBottom();\r\n    }, [messages, events]); // Only scroll on new messages or events, not on place results\r\n\r\n    const searchEvents = async (keyword: string) => {\r\n        setIsSearchingEvents(true);\r\n        setHasSearchedEvents(false);\r\n        isDirtyRef.current = true;\r\n        try {\r\n            const response = await fetch(`/api/events?keyword=${encodeURIComponent(keyword)}`);\r\n            const data = await response.json();\r\n            if (data.events && data.events.length > 0) {\r\n                setEvents(data.events);\r\n            } else {\r\n                setEvents([]);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error searching events:', error);\r\n            setEvents([]);\r\n        } finally {\r\n            setIsSearchingEvents(false);\r\n            setHasSearchedEvents(true);\r\n        }\r\n    };\r\n\r\n    const searchPlaces = async (params: { type: string; radius: number; keyword?: string; center?: { lat: number; lng: number } }) => {\r\n        setIsSearchingPlaces(true);\r\n\r\n        const searchCenter = params.center || selectedEvent?.location;\r\n\r\n        if (!searchCenter) {\r\n            console.warn('Cannot search places: No location available');\r\n            setIsSearchingPlaces(false);\r\n            return;\r\n        }\r\n\r\n        // Determine which list to update based on request type\r\n        const isHotelSearch = params.type.includes('hotel') || params.type.includes('lodging');\r\n\r\n        if (isHotelSearch) {\r\n            setHotelResults([]);\r\n            setIsHotelsExpanded(true); // Auto-expand when searching hotels\r\n        } else {\r\n            setRestaurantResults([]);\r\n            setIsHotelsExpanded(false); // Auto-collapse hotels when searching food\r\n        }\r\n\r\n        try {\r\n            const types = params.type.split(',').map(t => t.trim());\r\n            const allPlaces: Place[] = [];\r\n\r\n            for (const placeType of types) {\r\n                const apiType = placeType === 'hotel' ? 'lodging' : 'restaurant';\r\n                const url = `/api/places?lat=${searchCenter.lat}&lng=${searchCenter.lng}&type=${apiType}&radius=${params.radius}&minRating=0&keyword=${encodeURIComponent(params.keyword || '')}`;\r\n\r\n                console.log(`Searching Google Places for ${apiType} at`, searchCenter);\r\n                const response = await fetch(url);\r\n                const data = await response.json();\r\n\r\n                if (data.places) {\r\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                    const googlePlaces = data.places.map((p: any) => ({ ...p }));\r\n                    allPlaces.push(...googlePlaces);\r\n                }\r\n            }\r\n\r\n            if (isHotelSearch) {\r\n                setHotelResults(allPlaces);\r\n            } else {\r\n                setRestaurantResults(allPlaces);\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('Error searching places:', error);\r\n            if (isHotelSearch) setHotelResults([]); else setRestaurantResults([]);\r\n        } finally {\r\n            setIsSearchingPlaces(false);\r\n            setHasSearchedPlaces(true);\r\n        }\r\n    };\r\n\r\n    // Parse [FIND_PLACES] command from AI response\r\n    const checkForPlacesTrigger = (text: string): boolean => {\r\n        const placesMatch = text.match(/\\[FIND_PLACES:\\s*(.+?)\\]/i);\r\n        if (placesMatch) {\r\n            // Check if we have a selected event with location BEFORE parsing\r\n            if (!selectedEvent?.location) {\r\n                console.warn('Cannot search places: No event location available for selected event:', selectedEvent);\r\n                // Don't add messages here - just return false and let the AI response show\r\n                return false;\r\n            }\r\n\r\n            const paramsStr = placesMatch[1];\r\n            const params: any = { type: 'restaurant', radius: 1500 };\r\n\r\n            // Parse parameters\r\n            paramsStr.split('|').forEach(part => {\r\n                const [key, value] = part.split('=').map(s => s.trim());\r\n                if (key === 'type') params.type = value;\r\n                if (key === 'radius') params.radius = parseInt(value) || 1500;\r\n            });\r\n\r\n            console.log('Searching places with params:', params, 'from location:', selectedEvent.location);\r\n            searchPlaces(params);\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // Check AI response for search trigger\r\n    const checkForSearchTrigger = (text: string) => {\r\n        const searchMatch = text.match(/\\[SEARCH_EVENT:\\s*(.+?)\\]/i);\r\n        if (searchMatch) {\r\n            const keyword = searchMatch[1].trim();\r\n            searchEvents(keyword);\r\n            return keyword;\r\n        }\r\n        return null;\r\n    };\r\n\r\n    // Check for [ASK_HOTELS] trigger\r\n    const checkForAskHotelsTrigger = (text: string) => {\r\n        if (text.includes('[ASK_HOTELS]')) {\r\n            setWaitingForConfirmation('hotels');\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // Check for [CONFIRM_EVENT] trigger\r\n    const checkForConfirmTrigger = (text: string) => {\r\n        if (text.includes('[CONFIRM_EVENT]')) {\r\n            setWaitingForConfirmation('event');\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    // Clean the search triggers from display text\r\n    const cleanDisplayText = (text: string) => {\r\n        return text\r\n            .replace(/\\[SEARCH_EVENT:\\s*.+?\\]/gi, '')\r\n            .replace(/\\[FIND_PLACES:\\s*.+?\\]/gi, '')\r\n            .replace(/\\[SEARCH_EVENT:\\s*.+?\\]/gi, '')\r\n            .replace(/\\[FIND_PLACES:\\s*.+?\\]/gi, '')\r\n            .replace(/\\[ASK_HOTELS\\]/gi, '')\r\n            .trim();\r\n    };\r\n\r\n\r\n    const [highlightedEventId, setHighlightedEventId] = useState<string | null>(null);\r\n\r\n\r\n    const handleEventSelect = (event: Event) => {\r\n        setHighlightedEventId(event.id);\r\n        // Visual highlight only, do not set selectedEvent yet\r\n    };\r\n\r\n    const handleEventConfirm = (event: Event) => {\r\n        console.log('Confirmed event:', event);\r\n        isDirtyRef.current = true;\r\n        setSelectedEvent(event);\r\n        setHighlightedEventId(null);\r\n        setEvents([]); // Hide list\r\n        setHotelResults([]);\r\n        setRestaurantResults([]);\r\n        setWaitingForConfirmation(null);\r\n\r\n        const eventMessage = {\r\n            role: 'user',\r\n            content: `I want to attend: ${event.name} at ${event.venue} in ${event.city}, ${event.state} on ${event.date}`\r\n        };\r\n\r\n        const newMessages = [...messages, eventMessage];\r\n        setMessages(newMessages);\r\n\r\n        // Set chat title to event name - this triggers the auto-save useEffect\r\n        // once state updates are processed (including selectedEvent)\r\n        setChatTitle(event.name);\r\n\r\n        sendToAI(newMessages);\r\n    };\r\n\r\n    const handlePlaceSelect = (place: Place) => {\r\n        setSelectedPlace(place);\r\n    };\r\n\r\n    const handlePlaceConfirm = (place: Place) => {\r\n        // Add to itinerary\r\n        isDirtyRef.current = true;\r\n        setItinerary(prev => [...prev, place]);\r\n        setSelectedPlace(null);\r\n\r\n        const isHotel = place.types?.includes('lodging') || place.types?.includes('hotel');\r\n        const isFromExplore = exploreResults.some(p => p.id === place.id);\r\n\r\n        // Remove from correct list\r\n        if (isHotel) {\r\n            setHotelResults(prev => prev.filter(p => p.id !== place.id));\r\n        } else if (isFromExplore) {\r\n            setExploreResults(prev => prev.filter(p => p.id !== place.id));\r\n        } else {\r\n            setRestaurantResults(prev => prev.filter(p => p.id !== place.id));\r\n        }\r\n\r\n        // Let AI know\r\n        const placeMessage = {\r\n            role: 'user',\r\n            content: `I'd like to add ${place.name} to my itinerary.`\r\n        };\r\n\r\n        const newMessages = [...messages, placeMessage];\r\n        setMessages(newMessages);\r\n        sendToAI(newMessages);\r\n\r\n        // Check if it was a hotel to trigger Food prompt, otherwise trigger Explore prompt\r\n        // Don't trigger explore if already exploring\r\n        if (isHotel) {\r\n            setWaitingForConfirmation('food');\r\n        } else if (!isFromExplore) {\r\n            // For restaurants (not from explore), prompt to explore activities\r\n            setWaitingForConfirmation('explore');\r\n        }\r\n        // If from explore, just stay in explore_filters or clear\r\n    };\r\n\r\n    const confirmFood = (confirmed: boolean) => {\r\n        if (confirmed) {\r\n            setWaitingForConfirmation('food_filters'); // Updated state\r\n            // Reset filters logic\r\n            setFoodFilters(prev => ({ ...prev, locationPreference: 'venue', radius: 1600, cuisine: '' }));\r\n        } else {\r\n            setWaitingForConfirmation(null);\r\n            handleQuickReply(\"No thanks. (If you change your mind, click 'Find Food' or type 'find food'.)\");\r\n        }\r\n    };\r\n\r\n    const executeFoodSearch = () => {\r\n        const cuisine = foodFilters.cuisine;\r\n        if (!cuisine.trim()) return;\r\n        setWaitingForConfirmation('food_filters'); // Keep filters open\r\n\r\n        // Determine Center\r\n        let searchCenter = selectedEvent?.location;\r\n        let locationName = \"the venue\";\r\n\r\n        if (foodFilters.locationPreference === 'hotel') {\r\n            // Find last hotel in itinerary\r\n            const hotel = itinerary.slice().reverse().find(i => 'types' in i && (i.types.includes('lodging') || i.types.includes('hotel'))) as Place | undefined;\r\n            if (hotel && hotel.location) {\r\n                searchCenter = hotel.location;\r\n                locationName = hotel.name;\r\n            } else {\r\n                console.warn('No hotel found in itinerary, defaulting to venue');\r\n            }\r\n        }\r\n\r\n        const searchQuery = `${cuisine} restaurants`;\r\n        const userMessage = {\r\n            role: 'user',\r\n            content: `Find me ${searchQuery} near ${locationName} (within ${(foodFilters.radius / 1600).toFixed(1)} miles).`\r\n        };\r\n        setMessages(prev => [...prev, userMessage]);\r\n\r\n        searchPlaces({\r\n            type: 'restaurant',\r\n            radius: foodFilters.radius,\r\n            keyword: cuisine,\r\n            center: searchCenter || undefined\r\n        });\r\n    };\r\n\r\n    const confirmExplore = (confirmed: boolean) => {\r\n        if (confirmed) {\r\n            setWaitingForConfirmation('explore_filters');\r\n            setExploreFilters(prev => ({ ...prev, locationPreference: 'venue', radius: 8000, activity: '' }));\r\n        } else {\r\n            setWaitingForConfirmation(null);\r\n            handleQuickReply(\"No thanks. (If you change your mind, click 'Explore' or type 'explore'.)\");\r\n        }\r\n    };\r\n\r\n    const executeExploreSearch = () => {\r\n        const activity = exploreFilters.activity;\r\n        if (!activity.trim()) return;\r\n        setWaitingForConfirmation('explore_filters'); // Keep filters open\r\n\r\n        // Determine Center\r\n        let searchCenter = selectedEvent?.location;\r\n        let locationName = \"the venue\";\r\n\r\n        if (exploreFilters.locationPreference === 'hotel') {\r\n            const hotel = itinerary.slice().reverse().find(i => 'types' in i && (i.types.includes('lodging') || i.types.includes('hotel'))) as Place | undefined;\r\n            if (hotel && hotel.location) {\r\n                searchCenter = hotel.location;\r\n                locationName = hotel.name;\r\n            } else {\r\n                console.warn('No hotel found in itinerary, defaulting to venue');\r\n            }\r\n        }\r\n\r\n        const userMessage = {\r\n            role: 'user',\r\n            content: activity === 'Popular'\r\n                ? `Find me the most popular things to do near ${locationName} (within ${(exploreFilters.radius / 1600).toFixed(1)} miles).`\r\n                : `Find me ${activity} near ${locationName} (within ${(exploreFilters.radius / 1600).toFixed(1)} miles).`\r\n        };\r\n        setMessages(prev => [...prev, userMessage]);\r\n\r\n        // Clear previous explore results\r\n        setExploreResults([]);\r\n        setIsSearchingPlaces(true);\r\n\r\n        // Search using a general type with the activity as keyword\r\n        const searchExplore = async () => {\r\n            if (!searchCenter) {\r\n                console.warn('No search center available');\r\n                setIsSearchingPlaces(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Map common activities to Google Places types\r\n                const activityLower = activity.toLowerCase();\r\n                let placeType = 'tourist_attraction';\r\n                let searchKeyword = activity;\r\n\r\n                if (activity === 'Popular') {\r\n                    placeType = 'tourist_attraction';\r\n                    searchKeyword = ''; // Don't filter by keyword for popular to get top rated stuff\r\n                } else if (activityLower.includes('movie') || activityLower.includes('cinema') || activityLower.includes('theater')) {\r\n                    placeType = 'movie_theater';\r\n                } else if (activityLower.includes('hik') || activityLower.includes('park') || activityLower.includes('nature')) {\r\n                    placeType = 'park';\r\n                } else if (activityLower.includes('museum') || activityLower.includes('art') || activityLower.includes('gallery')) {\r\n                    placeType = 'museum';\r\n                } else if (activityLower.includes('shop') || activityLower.includes('mall')) {\r\n                    placeType = 'shopping_mall';\r\n                } else if (activityLower.includes('bar') || activityLower.includes('club') || activityLower.includes('nightlife')) {\r\n                    placeType = 'night_club';\r\n                } else if (activityLower.includes('spa') || activityLower.includes('wellness')) {\r\n                    placeType = 'spa';\r\n                } else if (activityLower.includes('gym') || activityLower.includes('fitness')) {\r\n                    placeType = 'gym';\r\n                } else if (activityLower.includes('hotel') || activityLower.includes('lodging')) {\r\n                    placeType = 'lodging';\r\n                } else if (activityLower.includes('food') || activityLower.includes('restaurant') || activityLower.includes('eat')) {\r\n                    placeType = 'restaurant';\r\n                }\r\n\r\n                const url = `/api/places?lat=${searchCenter.lat}&lng=${searchCenter.lng}&type=${placeType}&radius=${exploreFilters.radius}&minRating=0&keyword=${encodeURIComponent(searchKeyword)}`;\r\n\r\n                console.log(`Exploring ${activity} (type: ${placeType}) at`, searchCenter);\r\n                const response = await fetch(url);\r\n                const data = await response.json();\r\n\r\n                if (data.places) {\r\n                    setExploreResults(data.places);\r\n                } else {\r\n                    setExploreResults([]);\r\n                }\r\n            } catch (error) {\r\n                console.error('Error searching explore:', error);\r\n                setExploreResults([]);\r\n            } finally {\r\n                setIsSearchingPlaces(false);\r\n                setHasSearchedPlaces(true);\r\n            }\r\n        };\r\n\r\n        searchExplore();\r\n    };\r\n\r\n\r\n\r\n    const removeFromItinerary = (id: string) => {\r\n        isDirtyRef.current = true;\r\n        setItinerary(prev => prev.filter(item => item.id !== id));\r\n    };\r\n\r\n    const handleItinerarySubmission = async () => {\r\n        if (!selectedEvent && itinerary.length === 0) return;\r\n\r\n        const mainEvent = selectedEvent\r\n            ? `Main Event: ${selectedEvent.name} at ${selectedEvent.venue} on ${selectedEvent.date} at ${selectedEvent.time}.`\r\n            : \"No main event selected.\";\r\n\r\n        const itineraryItems = itinerary.map((item, index) => {\r\n            const type = 'types' in item && (item.types.includes('lodging') || item.types.includes('hotel'))\r\n                ? 'Hotel'\r\n                : 'types' in item && item.types.includes('restaurant')\r\n                    ? 'Restaurant'\r\n                    : 'Activity';\r\n            return `${index + 1}. ${item.name} (${type}) - ${item.address || 'No address'}`;\r\n        }).join('\\n');\r\n\r\n        const prompt = `\r\nI have planned the following itinerary:\r\n\r\n${mainEvent}\r\n\r\nMy curated list of places:\r\n${itineraryItems}\r\n\r\nPlease create a detailed, time-based schedule for my trip.\r\n- Start from arrival (or reasonable morning time).\r\n- Include travel time estimates between locations.\r\n- Suggest logical gaps where I might need rest or additional activities.\r\n- Ensure I arrive at the main event on time.\r\n- If I'm missing meals or a hotel, please politely suggest adding them.\r\n- Be conversational in your main response, but DO NOT list the full schedule in the text. Instead, say \"I've generated your schedule, click 'View Schedule' to see it.\"\r\n- IMPORTANT: Use AM/PM format (e.g., \"7:00 PM\") for all times, NOT military time.\r\n- IMPORTANT: At the very end of your response, strictly output the schedule as a JSON array inside a \\`\\`\\`json block.\r\n- Format:\r\n\\`\\`\\`json\r\n[\r\n  { \"time\": \"hh:mm start - hh:mm end\", \"activity\": \"Title\", \"description\": \"Short description\" }\r\n]\r\n\\`\\`\\`\r\nGoal: A complete, optimized itinerary plan.\r\n        `;\r\n\r\n        // Show simple message to user\r\n        const simpleUserMessage = { role: 'user', content: \"Can you generate a schedule for me?\" };\r\n        setMessages(prev => [...prev, simpleUserMessage]);\r\n\r\n        // Send FULL prompt to AI (but keep simple message in UI history)\r\n        // We temporarily append the complex prompt to the message history sent to AI, \r\n        // but don't add it to the 'messages' state that is rendered.\r\n        // Actually, to make 'sendToAI' work with the current 'messages' state, we need to handle this carefully.\r\n        // The sendToAI function takes 'messagesToSend'. We can construct that manually.\r\n\r\n        const complexMessage = { role: 'user', content: prompt };\r\n        sendToAI([...messages, complexMessage]);\r\n        setTimeout(() => scrollToBottom(), 200);\r\n    };\r\n\r\n    const sendToAI = async (messagesToSend: Array<{ role: string, content: string }>) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await fetch('/api/chat', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ messages: messagesToSend }),\r\n            });\r\n\r\n            if (!response.body) throw new Error('No response body');\r\n\r\n            const reader = response.body.getReader();\r\n            const decoder = new TextDecoder();\r\n            const assistantMessage = { role: 'assistant', content: '' };\r\n            let fullResponse = '';\r\n            let searchTriggered = false;\r\n            let placesTriggered = false;\r\n            let askHotelsTriggered = false;\r\n\r\n            setMessages(prev => [...prev, assistantMessage]);\r\n\r\n            while (true) {\r\n                const { done, value } = await reader.read();\r\n                if (done) break;\r\n\r\n                const text = decoder.decode(value, { stream: true });\r\n                fullResponse += text;\r\n\r\n                // Check for triggers\r\n                if (!searchTriggered) {\r\n                    const searchKeyword = checkForSearchTrigger(fullResponse);\r\n                    if (searchKeyword) searchTriggered = true;\r\n                }\r\n                if (!placesTriggered) {\r\n                    if (checkForPlacesTrigger(fullResponse)) {\r\n                        console.log('PLACES TRIGGER FOUND!');\r\n                        placesTriggered = true;\r\n                    }\r\n                }\r\n                if (!askHotelsTriggered) {\r\n                    if (checkForAskHotelsTrigger(fullResponse)) {\r\n                        askHotelsTriggered = true;\r\n                    }\r\n                }\r\n                if (!checkForConfirmTrigger(fullResponse)) {\r\n                    // Just check\r\n                }\r\n\r\n                // Extract JSON schedule if present\r\n                const jsonMatch = fullResponse.match(/```json\\s*(\\[\\s*\\{[\\s\\S]*\\}\\s*\\])\\s*```/);\r\n                if (jsonMatch) {\r\n                    try {\r\n                        const jsonContent = jsonMatch[1];\r\n                        const parsedSchedule = JSON.parse(jsonContent);\r\n                        if (Array.isArray(parsedSchedule)) {\r\n                            setSchedule(parsedSchedule);\r\n                            isDirtyRef.current = true;\r\n                            // Remove the JSON block from the displayed message\r\n                            assistantMessage.content = cleanDisplayText(fullResponse.replace(jsonMatch[0], '').trim());\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('Failed to parse AI schedule JSON', e);\r\n                        assistantMessage.content = cleanDisplayText(fullResponse);\r\n                    }\r\n                } else {\r\n                    assistantMessage.content = cleanDisplayText(fullResponse);\r\n                }\r\n\r\n                setMessages(prev => {\r\n                    const updated = [...prev];\r\n                    updated[updated.length - 1] = { ...assistantMessage };\r\n                    return updated;\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Chat error:', error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleQuickReply = (text: string) => {\r\n        if (isLoading) return;\r\n        const userMessage = { role: 'user', content: text };\r\n        const newMessages = [...messages, userMessage];\r\n        setMessages(newMessages);\r\n        sendToAI(newMessages);\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!input.trim() || isLoading) return;\r\n\r\n        isDirtyRef.current = true;\r\n        const userMessage = { role: 'user', content: input };\r\n        const newMessages = [...messages, userMessage];\r\n\r\n        setMessages(newMessages);\r\n        setInput('');\r\n\r\n        // --- Automate Filter Triggers based on user input ---\r\n        const lowerInput = input.toLowerCase();\r\n\r\n        // 1. Explore Automation\r\n        if (lowerInput.includes('explore') || (lowerInput.includes('find') && (lowerInput.includes('activity') || lowerInput.includes('things to do')))) {\r\n            setWaitingForConfirmation('explore_filters');\r\n            setExploreFilters(prev => ({ ...prev, locationPreference: 'venue', radius: 8000, activity: '' }));\r\n        }\r\n        // 2. Hotels Automation\r\n        else if (lowerInput.includes('find') && (lowerInput.includes('hotel') || lowerInput.includes('lodging'))) {\r\n            setWaitingForConfirmation('hotels_filters');\r\n            setIsHotelsExpanded(true);\r\n        }\r\n        // 3. Food Automation\r\n        else if (lowerInput.includes('find') && (lowerInput.includes('food') || lowerInput.includes('restaurant'))) {\r\n            setWaitingForConfirmation('food_filters');\r\n            setFoodFilters(prev => ({ ...prev, locationPreference: 'venue', radius: 1600, cuisine: '' }));\r\n        }\r\n\r\n        sendToAI(newMessages);\r\n    };\r\n\r\n    const confirmHotels = (confirmed: boolean) => {\r\n        if (confirmed) {\r\n            setWaitingForConfirmation('hotels_filters');\r\n            // handleQuickReply(\"Yes, please find hotels.\"); // Optional: verify filters\r\n        } else {\r\n            setWaitingForConfirmation(null);\r\n            handleQuickReply(\"No thanks. (If you change your mind, just click 'Find Hotels' or type 'find hotels'.)\");\r\n        }\r\n    };\r\n\r\n    const executeFilteredSearch = () => {\r\n        setWaitingForConfirmation(null);\r\n\r\n        // Add User Message for context\r\n        const filterMsg = `Searching for hotels: ${(hotelFilters.radius / 1600).toFixed(0)} mi radius`;\r\n        const userMessage = { role: 'user', content: filterMsg };\r\n        setMessages(prev => [...prev, userMessage]);\r\n\r\n        // Trigger Search Directly\r\n        searchPlaces({\r\n            type: 'hotel',\r\n            radius: hotelFilters.radius\r\n        });\r\n    };\r\n\r\n    const formatDate = (date: string) => {\r\n        if (!date || date === 'TBD') return 'Date TBD';\r\n        return new Date(date).toLocaleDateString('en-US', {\r\n            weekday: 'short',\r\n            month: 'short',\r\n            day: 'numeric',\r\n            year: 'numeric'\r\n        });\r\n    };\r\n\r\n    // -- RENDER HELPER: Places Grid --\r\n    const renderPlacesGrid = (placesList: Place[], isHotel: boolean) => (\r\n        <div className=\"grid grid-cols-1 gap-4\">\r\n            {placesList.map((place) => {\r\n                return (\r\n                    <div\r\n                        key={place.id}\r\n                        onClick={() => handlePlaceSelect(place)}\r\n                        onDoubleClick={() => handlePlaceConfirm(place)}\r\n                        className={`bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-all cursor-pointer border-2 overflow-hidden flex flex-col sm:flex-row ${selectedPlace?.id === place.id ? 'border-green-500 ring-2 ring-green-300 transform scale-[1.01]' : 'border-transparent dark:border-gray-700 hover:border-green-500'\r\n                            }`}\r\n                    >\r\n                        <PlaceImage place={place} />\r\n                        <div className=\"p-3 flex-1 min-w-0\">\r\n                            <h4 className=\"font-bold text-gray-800 dark:text-gray-100 truncate\">{place.name}</h4>\r\n                            <div className=\"flex items-center gap-2 text-sm flex-wrap mt-1\">\r\n                                {place.rating > 0 && (\r\n                                    <span className=\"text-yellow-500 font-semibold tracking-wide\">\r\n                                        {'â˜…'.repeat(Math.round(place.rating))}{'â˜†'.repeat(5 - Math.round(place.rating))}\r\n                                        <span className=\"text-gray-400 font-normal ml-1\">({place.rating})</span>\r\n                                        {place.userRatingsTotal > 0 && (\r\n                                            <span className=\"text-gray-400 font-normal ml-1\">â€¢ {place.userRatingsTotal} reviews</span>\r\n                                        )}\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300 truncate mt-1\">ðŸ“ {place.address || 'Address N/A'}</p>\r\n\r\n                            {isHotel && (\r\n                                <a\r\n                                    href={`https://www.expedia.com/Hotel-Search?destination=${encodeURIComponent(place.name + ' ' + (place.address || ''))}`}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"mt-2 inline-block bg-blue-600 text-white text-xs px-2 py-1 rounded hover:bg-blue-700 transition-colors\"\r\n                                    onClick={(e) => e.stopPropagation()}\r\n                                >\r\n                                    Book on Expedia â†—\r\n                                </a>\r\n                            )}\r\n\r\n                            {!isHotel && (\r\n                                <a\r\n                                    href={`https://www.google.com/search?q=${encodeURIComponent(place.name + ' ' + (place.address || '') + ' reviews')}`}\r\n                                    target=\"_blank\"\r\n                                    rel=\"noopener noreferrer\"\r\n                                    className=\"mt-2 inline-block bg-orange-600 text-white text-xs px-2 py-1 rounded hover:bg-orange-700 transition-colors\"\r\n                                    onClick={(e) => e.stopPropagation()}\r\n                                >\r\n                                    Google Reviews â†—\r\n                                </a>\r\n                            )}\r\n\r\n                            {!isHotel && place.openNow !== undefined && (\r\n                                <p className={`text-sm ${place.openNow ? 'text-green-600' : 'text-red-600'}`}>\r\n                                    {place.openNow ? 'âœ“ Open now' : 'âœ— Closed'}\r\n                                </p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                );\r\n            })}\r\n        </div >\r\n    );\r\n\r\n    // Memoize map points to prevent re-renders on typing\r\n    const mapPlaces = useMemo(() => {\r\n        if (waitingForConfirmation === 'food' || waitingForConfirmation === 'food_filters') {\r\n            return restaurantResults;\r\n        }\r\n        if (waitingForConfirmation === 'hotels' || waitingForConfirmation === 'hotels_filters') {\r\n            return hotelResults;\r\n        }\r\n        if (waitingForConfirmation === 'explore' || waitingForConfirmation === 'explore_filters') {\r\n            return exploreResults;\r\n        }\r\n        return [];\r\n    }, [waitingForConfirmation, restaurantResults, hotelResults, exploreResults]);\r\n\r\n    const restoreFiltersFromMessage = (content: string) => {\r\n        // 1. Extract Radius\r\n        let radius = 8000;\r\n        // Support both \"within X miles\" and \"X mi radius\" formats\r\n        const radiusMatch = content.match(/within ([\\d.]+) miles/) || content.match(/([\\d.]+) mi radius/);\r\n        if (radiusMatch) {\r\n            radius = Math.round(parseFloat(radiusMatch[1]) * 1600);\r\n        }\r\n\r\n        // 2. Extract Location Preference\r\n        let locationPreference: 'venue' | 'hotel' = 'venue';\r\n        if (content.toLowerCase().includes('near hotel') || content.toLowerCase().includes('near the hotel')) {\r\n            locationPreference = 'hotel';\r\n        }\r\n\r\n        // 3. Determine Type and Specific Filters\r\n        // Use lowercase for robust matching\r\n        const lowerContent = content.toLowerCase();\r\n\r\n        if (lowerContent.includes('find me hotels') || lowerContent.includes('find me lodging') || lowerContent.includes('searching for hotels')) {\r\n            setHotelFilters({ radius });\r\n            setWaitingForConfirmation('hotels_filters');\r\n        } else if (lowerContent.includes('restaurant') || lowerContent.includes('food')) {\r\n            let cuisine = '';\r\n            // Pattern: \"Find me [Cuisine] near\" or \"Find me [Cuisine] restaurants near\"\r\n            // Note: The message generation logic is: `Find me ${cuisine} restaurants near...`\r\n            // So if cuisine='Mexican', message='Find me Mexican restaurants near...'\r\n            // We want to extract 'Mexican'.\r\n            const match = content.match(/Find me (.+) near/i);\r\n            if (match) {\r\n                const captured = match[1].trim();\r\n                // Strip \"restaurants\" or \"food\" if present to get raw cuisine\r\n                cuisine = captured.replace(/restaurants|restaurant|food/gi, '').trim();\r\n            }\r\n            setFoodFilters({ locationPreference, radius, cuisine });\r\n            setWaitingForConfirmation('food_filters');\r\n        } else {\r\n            // Explore\r\n            let activity = '';\r\n            const match = content.match(/Find me (.+) near/i);\r\n            if (match) {\r\n                activity = match[1].trim();\r\n                if (activity.toLowerCase().includes('popular things to do')) {\r\n                    activity = 'Popular';\r\n                }\r\n            }\r\n            // Ensure we don't accidentally set \"restaurants\" as activity if regex missed above\r\n            if (activity.toLowerCase().includes('restaurant')) return;\r\n\r\n            setExploreFilters({ locationPreference, radius, activity });\r\n            setWaitingForConfirmation('explore_filters');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col lg:flex-row w-full h-full bg-gray-50 dark:bg-gray-950 overflow-hidden text-gray-800 dark:text-gray-100\">\r\n            {/* LEFT PANEL: Chat & Itinerary (Scrollable) */}\r\n            <div className={`w-full lg:w-1/2 h-full overflow-y-auto p-2 md:p-4 flex flex-col transition-opacity duration-300 ease-in-out ${isSidebarOpen ? 'opacity-20 pointer-events-none' : 'opacity-100'}`}>\r\n                <div className=\"w-full h-full flex flex-col\">\r\n                    {/* Chat Messages */}\r\n                    <div className=\"space-y-4 mb-4 flex-grow\">\r\n                        {messages.length === 0 && (\r\n                            <div className=\"flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-gray-400 py-8\">\r\n                                <div className=\"mb-4 animate-bounce-slow\">\r\n                                    {/* Simple Gopher Icon */}\r\n                                    <svg width=\"80\" height=\"80\" viewBox=\"0 0 100 100\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                        {/* Head/Body */}\r\n                                        <rect x=\"25\" y=\"30\" width=\"50\" height=\"70\" rx=\"25\" fill=\"#10B981\" />\r\n                                        {/* Ears */}\r\n                                        <circle cx=\"25\" cy=\"40\" r=\"10\" fill=\"#10B981\" />\r\n                                        <circle cx=\"25\" cy=\"40\" r=\"5\" fill=\"#A7F3D0\" />\r\n                                        <circle cx=\"75\" cy=\"40\" r=\"10\" fill=\"#10B981\" />\r\n                                        <circle cx=\"75\" cy=\"40\" r=\"5\" fill=\"#A7F3D0\" />\r\n                                        {/* Face Details */}\r\n                                        <circle cx=\"40\" cy=\"55\" r=\"4\" fill=\"#064E3B\" />\r\n                                        <circle cx=\"60\" cy=\"55\" r=\"4\" fill=\"#064E3B\" />\r\n                                        <ellipse cx=\"50\" cy=\"65\" rx=\"8\" ry=\"5\" fill=\"#047857\" />\r\n                                        <rect x=\"46\" y=\"68\" width=\"8\" height=\"6\" rx=\"1\" fill=\"white\" />\r\n                                    </svg>\r\n                                </div>\r\n                                <p className=\"text-lg font-medium text-gray-700 dark:text-gray-200\">Tell me about an event or artist you want to see!</p>\r\n                                <p className=\"text-sm mt-2\">Example: &quot;I want to see Taylor Swift&quot; or &quot;Find Lakers games&quot;</p>\r\n                            </div>\r\n                        )}\r\n                        {messages.map((m, index) => {\r\n                            // Hide empty assistant messages (unless currently loading last message)\r\n                            const isLast = index === messages.length - 1;\r\n                            if (m.role === 'assistant' && !m.content.trim() && (!isLast || !isLoading)) return null;\r\n\r\n                            return (\r\n                                <div key={index} className={`p-4 rounded-lg ${m.role === 'user' ? 'bg-emerald-100 dark:bg-emerald-900 dark:text-emerald-100 ml-auto max-w-[90%]' : 'bg-white dark:bg-gray-800 shadow mr-auto max-w-[90%]'}`}>\r\n                                    <div className=\"font-semibold text-sm text-gray-600 dark:text-gray-400 mb-1\">\r\n                                        {m.role === 'user' ? 'ðŸ‘¤ You' : 'ðŸ¤– AI Assistant'}\r\n                                    </div>\r\n                                    <p className=\"whitespace-pre-wrap\">{m.content}</p>\r\n\r\n                                    {/* Reset / Options Button for Search Prompts */}\r\n                                    {m.role === 'user' && (m.content.startsWith('Find me') || m.content.startsWith('Searching for hotels')) && (\r\n                                        <button\r\n                                            onClick={() => restoreFiltersFromMessage(m.content)}\r\n                                            className=\"mt-2 text-xs bg-white/50 dark:bg-black/20 hover:bg-white/80 dark:hover:bg-black/40 text-blue-800 dark:text-blue-300 px-2 py-1 rounded transition-colors flex items-center gap-1 w-fit border border-blue-200 dark:border-blue-800\"\r\n                                            title=\"Restore these search options\"\r\n                                        >\r\n                                            ðŸ”„ Search Options\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            );\r\n                        })}\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    {/* Event Search Results */}\r\n                    {isSearchingEvents && (\r\n                        <div className=\"text-center py-4 text-gray-500\">\r\n                            <div className=\"animate-pulse\">ðŸ” Searching for events...</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {!selectedEvent && !isSearchingEvents && hasSearchedEvents && events.length === 0 && (\r\n                        <div className=\"text-center py-4 text-red-500 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 mb-4 animate-fadeIn\">\r\n                            <p className=\"dark:text-red-400\">âŒ No events found matching your request.</p>\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Try a different artist name or city.</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {events.length > 0 && (\r\n                        <div className=\"mb-6\">\r\n                            <h3 className=\"text-lg font-semibold mb-3 text-gray-700 dark:text-gray-200\">\r\n                                ðŸŽ­ Found {events.length} events - Select, then Double-click to Confirm:\r\n                            </h3>\r\n                            <div className=\"grid grid-cols-1 gap-4\">\r\n                                {events.map((event) => (\r\n                                    <div\r\n                                        key={event.id}\r\n                                        onClick={() => handleEventSelect(event)}\r\n                                        onDoubleClick={() => handleEventConfirm(event)}\r\n                                        className={`bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-all cursor-pointer border-2 overflow-hidden flex flex-col sm:flex-row ${highlightedEventId === event.id ? 'border-green-500 ring-2 ring-green-300 transform scale-[1.01]' : 'border-transparent dark:border-gray-700 hover:border-blue-500'\r\n                                            }`}\r\n                                    >\r\n                                        {event.image && (\r\n                                            /* eslint-disable-next-line @next/next/no-img-element */\r\n                                            <img src={event.image} alt={event.name} className=\"w-full sm:w-32 h-32 object-cover\" />\r\n                                        )}\r\n                                        <div className=\"p-3 flex-1 min-w-0\">\r\n                                            <h4 className=\"font-bold text-gray-800 dark:text-gray-100 truncate\">{event.name}</h4>\r\n                                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">ðŸ“… {formatDate(event.date)}</p>\r\n                                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">ðŸ“ {event.venue}</p>\r\n                                            <p className=\"text-sm text-gray-500 dark:text-gray-400 truncate\">{event.city}, {event.state}</p>\r\n                                            <p className=\"text-sm font-semibold text-green-600 dark:text-green-400 mt-1\">{event.priceRange}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Loading State */}\r\n                    {isSearchingPlaces && (\r\n                        <div className=\"text-center py-4 text-gray-500\">\r\n                            <div className=\"animate-pulse\">ðŸ” Finding nearby places...</div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* ----- HOTELS SECTION (Show only when not in food or explore mode) ----- */}\r\n                    {hotelResults.length > 0 && !['food', 'food_filters', 'explore', 'explore_filters'].includes(waitingForConfirmation) && (\r\n                        <div className=\"mb-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm\">\r\n                            <div className=\"bg-gray-50 dark:bg-gray-800 p-3 flex justify-between items-center border-b border-gray-200 dark:border-gray-700\">\r\n                                <h3 className=\"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2\">\r\n                                    ðŸ¨ Found {hotelResults.length} Hotels\r\n                                </h3>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"text-xs text-gray-500 font-medium\">\r\n                                        {hotelFilters.radius / 1600} mi radius\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4 bg-gray-50/50 dark:bg-gray-800/50 rounded-lg border border-gray-100 dark:border-gray-700\">\r\n                                {/* Filter Controls */}\r\n                                <div className=\"mb-3 flex justify-end\">\r\n                                    <div className=\"flex items-center gap-1 bg-white dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 p-1\">\r\n                                        <span className=\"text-xs font-bold text-gray-400 px-1\">DIST:</span>\r\n                                        {[8000, 16000, 32000].map((r) => (\r\n                                            <button\r\n                                                key={r}\r\n                                                onClick={(e) => { e.stopPropagation(); setHotelFilters(prev => ({ ...prev, radius: r })); executeFilteredSearch(); }}\r\n                                                className={`px-2 py-0.5 text-xs font-bold rounded ${hotelFilters.radius === r ? 'bg-blue-600 text-white' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600'}`}\r\n                                            >\r\n                                                {(r / 1600).toFixed(0)}m\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"grid grid-cols-1 gap-4\">\r\n                                    {hotelResults.map((place) => {\r\n                                        if (!place) return null; // Safe check\r\n                                        return (\r\n                                            <div\r\n                                                key={place.id}\r\n                                                onClick={() => handlePlaceSelect(place)}\r\n                                                onDoubleClick={() => handlePlaceConfirm(place)}\r\n                                                className={`bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-all cursor-pointer border-2 overflow-hidden flex flex-col sm:flex-row ${selectedPlace?.id === place.id ? 'border-green-500 ring-2 ring-green-300 transform scale-[1.01]' : 'border-transparent dark:border-gray-700 hover:border-green-500'}`}\r\n                                            >\r\n                                                {place.photo ? (\r\n                                                    /* eslint-disable-next-line @next/next/no-img-element */\r\n                                                    <img src={place.photo} alt={place.name} className=\"w-full sm:w-32 h-32 object-cover\" />\r\n                                                ) : (\r\n                                                    <div className=\"w-full sm:w-32 h-32 bg-gray-200 flex items-center justify-center text-4xl\">\r\n                                                        ðŸ¨\r\n                                                    </div>\r\n                                                )}\r\n                                                <div className=\"p-3 flex-1 min-w-0\">\r\n                                                    <h4 className=\"font-bold text-gray-800 dark:text-gray-100 truncate\">{place.name}</h4>\r\n                                                    <div className=\"flex items-center gap-2 text-sm flex-wrap mt-1\">\r\n                                                        {place.rating > 0 && (\r\n                                                            <span className=\"text-yellow-500 font-semibold tracking-wide\">\r\n                                                                {'â˜…'.repeat(Math.round(place.rating))}{'â˜†'.repeat(5 - Math.round(place.rating))}\r\n                                                                <span className=\"text-gray-400 font-normal ml-1\">({place.rating})</span>\r\n                                                            </span>\r\n                                                        )}\r\n                                                    </div>\r\n\r\n                                                    <p className=\"text-sm text-gray-600 dark:text-gray-300 truncate mt-1\">ðŸ“ {place.address || 'Address N/A'}</p>\r\n\r\n                                                    <a\r\n                                                        href={`https://www.google.com/search?q=${encodeURIComponent(place.name + ' ' + (place.address || '') + ' reviews')}`}\r\n                                                        target=\"_blank\"\r\n                                                        rel=\"noopener noreferrer\"\r\n                                                        className=\"mt-2 inline-block bg-orange-600 text-white text-xs px-2 py-1 rounded hover:bg-orange-700 transition-colors\"\r\n                                                        onClick={(e) => e.stopPropagation()}\r\n                                                    >\r\n                                                        Google Reviews â†—\r\n                                                    </a>\r\n\r\n                                                    <a\r\n                                                        href={`https://www.expedia.com/Hotel-Search?destination=${encodeURIComponent(place.name + ' ' + (place.address || ''))}`}\r\n                                                        target=\"_blank\"\r\n                                                        rel=\"noopener noreferrer\"\r\n                                                        className=\"mt-2 inline-block bg-blue-600 text-white text-xs px-2 py-1 rounded hover:bg-blue-700 transition-colors\"\r\n                                                        onClick={(e) => e.stopPropagation()}\r\n                                                    >\r\n                                                        Book on Expedia â†—\r\n                                                    </a>\r\n                                                </div>\r\n                                            </div>\r\n                                        );\r\n                                    })}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* ----- RESTAURANTS SECTION (Show only when not in hotel or explore mode) ----- */}\r\n                    {restaurantResults.length > 0 && !['hotels', 'hotels_filters', 'explore', 'explore_filters'].includes(waitingForConfirmation) && (\r\n                        <div className=\"mb-6 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm\">\r\n                            <div className=\"bg-gray-50 dark:bg-gray-800 p-3 flex justify-between items-center border-b border-gray-200 dark:border-gray-700\">\r\n                                <h3 className=\"text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2\">\r\n                                    ðŸ½ï¸ Nearby Restaurants\r\n                                </h3>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full\">\r\n                                        {restaurantResults.length} found\r\n                                    </span>\r\n                                    <button\r\n                                        onClick={() => setWaitingForConfirmation('food_filters')}\r\n                                        className=\"text-xs text-orange-600 dark:text-orange-400 font-bold bg-orange-50 dark:bg-orange-900/30 px-3 py-1.5 rounded border border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/50 hover:border-orange-300 dark:hover:border-orange-700 transition-colors flex items-center gap-1\"\r\n                                    >\r\n                                        ðŸ”§ Filters: {foodFilters.cuisine || 'All'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4\">\r\n                                {renderPlacesGrid(restaurantResults, false)}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* ----- EXPLORE SECTION (Show only when in explore mode) ----- */}\r\n                    {exploreResults.length > 0 && ['explore', 'explore_filters', null].includes(waitingForConfirmation) && (\r\n                        <div className=\"mb-6 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm\">\r\n                            <div className=\"bg-gray-50 dark:bg-gray-800 p-3 flex justify-between items-center border-b border-gray-200 dark:border-gray-700\">\r\n                                <h3 className=\"text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2\">\r\n                                    ðŸŽ­ Explore Results\r\n                                </h3>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded-full\">\r\n                                        {exploreResults.length} found\r\n                                    </span>\r\n                                    <button\r\n                                        onClick={() => setWaitingForConfirmation('explore_filters')}\r\n                                        className=\"text-xs text-purple-600 dark:text-purple-400 font-bold bg-purple-50 dark:bg-purple-900/30 px-3 py-1.5 rounded border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/50 hover:border-purple-300 dark:hover:border-purple-700 transition-colors flex items-center gap-1\"\r\n                                    >\r\n                                        ðŸ”§ Filters: {exploreFilters.activity || 'All'}\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4\">\r\n                                {renderPlacesGrid(exploreResults, false)}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* NO RESULTS INDICATORS */}\r\n                    {hasSearchedPlaces && !isSearchingPlaces && (\r\n                        <>\r\n                            {waitingForConfirmation === 'hotels_filters' && hotelResults.length === 0 && (\r\n                                <div className=\"text-center py-4 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 mb-4\">\r\n                                    âŒ No hotels found with current filters.\r\n                                </div>\r\n                            )}\r\n                            {waitingForConfirmation === 'food_filters' && restaurantResults.length === 0 && (\r\n                                <div className=\"text-center py-4 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 mb-4\">\r\n                                    âŒ No restaurants found. Try changing filters.\r\n                                </div>\r\n                            )}\r\n                            {waitingForConfirmation === 'explore_filters' && exploreResults.length === 0 && (\r\n                                <div className=\"text-center py-4 text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 mb-4\">\r\n                                    âŒ No places found. Try increasing radius.\r\n                                </div>\r\n                            )}\r\n                        </>\r\n                    )}\r\n\r\n                    {/* Input Area */}\r\n                    <div className=\"sticky bottom-0 pt-2 pb-4 mt-auto bg-transparent\">\r\n                        {waitingForConfirmation === 'hotels' ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-2 animate-fadeIn bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 transition-colors\">\r\n                                <p className=\"mb-3 font-semibold text-gray-700 dark:text-gray-200\">Would you like to search for hotels nearby?</p>\r\n                                <div className=\"flex gap-4\">\r\n                                    <button\r\n                                        onClick={() => confirmHotels(true)}\r\n                                        className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-bold transition-all transform hover:scale-105\"\r\n                                    >\r\n                                        ðŸ¨ Yes, Find Hotels\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => confirmHotels(false)}\r\n                                        className=\"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-full font-bold transition-all\"\r\n                                    >\r\n                                        No, thanks\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : waitingForConfirmation === 'food' ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-2 animate-fadeIn bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 transition-colors\">\r\n                                <p className=\"mb-3 font-semibold text-gray-700 dark:text-gray-200\">Would you like to find restaurants nearby?</p>\r\n                                <div className=\"flex gap-4\">\r\n                                    <button\r\n                                        onClick={() => confirmFood(true)}\r\n                                        className=\"bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-full font-bold transition-all transform hover:scale-105\"\r\n                                    >\r\n                                        ðŸ½ï¸ Yes, Find Food\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => confirmFood(false)}\r\n                                        className=\"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-full font-bold transition-all\"\r\n                                    >\r\n                                        No, thanks\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : waitingForConfirmation === 'food_filters' ? (\r\n                            <div className=\"bg-orange-50 dark:bg-gray-800 p-4 rounded-lg animate-fadeIn border border-gray-200 dark:border-gray-700 transition-colors\">\r\n                                <div className=\"flex justify-between items-center mb-3\">\r\n                                    <h3 className=\"font-bold text-gray-700 dark:text-gray-200\">ðŸ½ï¸ Food Preferences</h3>\r\n                                    <button onClick={() => setWaitingForConfirmation(null)} className=\"text-gray-400 hover:text-gray-600\">Ã—</button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {/* 1. Location Toggle */}\r\n                                    <div className=\"flex bg-white dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 p-1\">\r\n                                        <button\r\n                                            onClick={() => setFoodFilters(prev => ({ ...prev, locationPreference: 'venue' }))}\r\n                                            className={`flex-1 py-1 rounded-md text-sm font-bold transition-colors ${foodFilters.locationPreference === 'venue' ? 'bg-orange-500 text-white shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                                        >\r\n                                            ðŸ“ Near Venue\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setFoodFilters(prev => ({ ...prev, locationPreference: 'hotel' }))}\r\n                                            className={`flex-1 py-1 rounded-md text-sm font-bold transition-colors ${foodFilters.locationPreference === 'hotel' ? 'bg-orange-500 text-white shadow-sm' : 'text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600'}`}\r\n                                            disabled={!itinerary.some(i => 'types' in i && (i.types.includes('lodging') || i.types.includes('hotel')))}\r\n                                        >\r\n                                            ðŸ¨ Near Hotel\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    {/* 2. Radius */}\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-400 uppercase\">Search Distance</label>\r\n                                        <div className=\"flex gap-2 mt-1\">\r\n                                            {[8000, 16000, 32000].map((r) => (\r\n                                                <button\r\n                                                    key={r}\r\n                                                    onClick={() => setFoodFilters(prev => ({ ...prev, radius: r }))}\r\n                                                    className={`px-3 py-1 rounded text-xs font-bold border ${foodFilters.radius === r ? 'bg-orange-600 text-white border-orange-600' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600'}`}\r\n                                                >\r\n                                                    {(r / 1600).toFixed(0)} mi\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* 3. Cuisine */}\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-400 uppercase\">Cuisine / Type</label>\r\n                                        <div className=\"flex flex-wrap gap-2 mt-1 mb-2\">\r\n                                            {['Italian', 'Mexican', 'Burgers', 'Sushi', 'Pizza', 'Coffee'].map(c => (\r\n                                                <button\r\n                                                    key={c}\r\n                                                    onClick={() => setFoodFilters(prev => ({ ...prev, cuisine: c }))}\r\n                                                    className={`px-2 py-1 rounded-full text-xs font-bold border ${foodFilters.cuisine === c ? 'bg-orange-100 text-orange-800 border-orange-300' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-orange-300'}`}\r\n                                                >\r\n                                                    {c}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                        <div className=\"flex gap-2\">\r\n                                            <input\r\n                                                className=\"flex-1 p-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded focus:border-orange-500 focus:outline-none\"\r\n                                                placeholder=\"Or type (e.g., 'Vegan')...\"\r\n                                                value={foodFilters.cuisine}\r\n                                                onChange={(e) => setFoodFilters(prev => ({ ...prev, cuisine: e.target.value }))}\r\n                                                autoFocus\r\n                                            />\r\n                                            <button\r\n                                                onClick={executeFoodSearch}\r\n                                                disabled={!foodFilters.cuisine.trim()}\r\n                                                className=\"bg-orange-600 text-white px-4 py-2 rounded font-bold hover:bg-orange-700 disabled:opacity-50\"\r\n                                            >\r\n                                                Search\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : waitingForConfirmation === 'hotels_filters' ? (\r\n                            <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg animate-fadeIn border border-gray-200 dark:border-gray-700 transition-colors\">\r\n                                <div className=\"flex justify-between items-center mb-4\">\r\n                                    <h3 className=\"font-bold text-gray-700 dark:text-gray-200\">ðŸ¨ Hotel Preferences</h3>\r\n                                    <button onClick={() => setWaitingForConfirmation(null)} className=\"text-gray-400 hover:text-gray-600\">Ã—</button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {/* Distance Only */}\r\n                                    <div>\r\n                                        <label className=\"text-xs font-semibold text-gray-500 uppercase\">Distance (Radius)</label>\r\n                                        <div className=\"flex gap-2 mt-1\">\r\n                                            {[8000, 16000, 32000].map((r) => (\r\n                                                <button\r\n                                                    key={r}\r\n                                                    onClick={() => setHotelFilters(prev => ({ ...prev, radius: r }))}\r\n                                                    className={`flex-1 py-1 rounded text-sm font-bold border ${hotelFilters.radius === r ? 'bg-blue-600 text-white border-blue-600' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600'}`}\r\n                                                >\r\n                                                    {(r / 1600).toFixed(0)} Miles\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    <button\r\n                                        onClick={executeFilteredSearch}\r\n                                        className=\"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold shadow-md transform active:scale-95 transition-all mt-2\"\r\n                                    >\r\n                                        ðŸ” Search Hotels\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : waitingForConfirmation === 'explore' ? (\r\n                            <div className=\"flex flex-col items-center justify-center py-2 animate-fadeIn bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 p-4 transition-colors\">\r\n                                <p className=\"mb-3 font-semibold text-gray-700 dark:text-gray-200\">Would you like to explore nearby activities?</p>\r\n                                <div className=\"flex gap-4\">\r\n                                    <button\r\n                                        onClick={() => confirmExplore(true)}\r\n                                        className=\"bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-full font-bold transition-all transform hover:scale-105\"\r\n                                    >\r\n                                        ðŸŽ­ Yes, Explore\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => confirmExplore(false)}\r\n                                        className=\"bg-gray-400 hover:bg-gray-500 text-white px-6 py-2 rounded-full font-bold transition-all\"\r\n                                    >\r\n                                        No, I&apos;m done\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ) : waitingForConfirmation === 'explore_filters' ? (\r\n                            <div className=\"bg-purple-50 dark:bg-gray-800 p-4 rounded-lg animate-fadeIn border border-purple-200 dark:border-gray-700 transition-colors\">\r\n                                <div className=\"flex justify-between items-center mb-3\">\r\n                                    <h3 className=\"font-bold text-gray-700 dark:text-gray-200\">ðŸŽ­ Explore Activities</h3>\r\n                                    <button onClick={() => setWaitingForConfirmation(null)} className=\"text-gray-400 hover:text-gray-600\">Ã—</button>\r\n                                </div>\r\n\r\n                                <div className=\"space-y-4\">\r\n                                    {/* 1. Location Toggle */}\r\n                                    <div className=\"flex bg-white dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 p-1\">\r\n                                        <button\r\n                                            onClick={() => setExploreFilters(prev => ({ ...prev, locationPreference: 'venue' }))}\r\n                                            className={`flex-1 py-1 rounded-md text-sm font-bold transition-colors ${exploreFilters.locationPreference === 'venue' ? 'bg-purple-500 text-white shadow-sm' : 'text-gray-500 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600'}`}\r\n                                        >\r\n                                            ðŸ“ Near Venue\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setExploreFilters(prev => ({ ...prev, locationPreference: 'hotel' }))}\r\n                                            className={`flex-1 py-1 rounded-md text-sm font-bold transition-colors ${exploreFilters.locationPreference === 'hotel' ? 'bg-purple-500 text-white shadow-sm' : 'text-gray-500 hover:bg-gray-50'}`}\r\n                                            disabled={!itinerary.some(i => 'types' in i && (i.types.includes('lodging') || i.types.includes('hotel')))}\r\n                                        >\r\n                                            ðŸ¨ Near Hotel\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    {/* 2. Radius */}\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-400 uppercase\">Search Distance</label>\r\n                                        <div className=\"flex gap-2 mt-1\">\r\n                                            {[8000, 16000, 32000].map((r) => (\r\n                                                <button\r\n                                                    key={r}\r\n                                                    onClick={() => setExploreFilters(prev => ({ ...prev, radius: r }))}\r\n                                                    className={`px-3 py-1 rounded text-xs font-bold border ${exploreFilters.radius === r ? 'bg-purple-600 text-white border-purple-600' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600'}`}\r\n                                                >\r\n                                                    {(r / 1600).toFixed(0)} mi\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* 3. Activity Presets */}\r\n                                    <div>\r\n                                        <label className=\"text-xs font-bold text-gray-400 uppercase\">What are you looking for?</label>\r\n                                        <div className=\"flex flex-wrap gap-2 mt-1 mb-2\">\r\n                                            {/* Popular Option */}\r\n                                            <button\r\n                                                onClick={() => setExploreFilters(prev => ({ ...prev, activity: 'Popular' }))}\r\n                                                className={`px-2 py-1 rounded-full text-xs font-bold border ${exploreFilters.activity === 'Popular' ? 'bg-red-100 text-red-800 border-red-300' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-red-300'}`}\r\n                                            >\r\n                                                ðŸ”¥ Most Popular\r\n                                            </button>\r\n\r\n                                            {['Movies', 'Hiking', 'Museums', 'Parks', 'Shopping', 'Nightlife', 'Spa'].map(a => (\r\n                                                <button\r\n                                                    key={a}\r\n                                                    onClick={() => setExploreFilters(prev => ({ ...prev, activity: a }))}\r\n                                                    className={`px-2 py-1 rounded-full text-xs font-bold border ${exploreFilters.activity === a ? 'bg-purple-100 text-purple-800 border-purple-300' : 'bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-200 dark:border-gray-600 hover:border-purple-300'}`}\r\n                                                >\r\n                                                    {a}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                        <div className=\"flex gap-2\">\r\n                                            <input\r\n                                                className=\"flex-1 p-2 text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded focus:border-purple-500 focus:outline-none\"\r\n                                                placeholder=\"Or type (e.g., 'Bowling')...\"\r\n                                                value={exploreFilters.activity}\r\n                                                onChange={(e) => setExploreFilters(prev => ({ ...prev, activity: e.target.value }))}\r\n                                            />\r\n                                            <button\r\n                                                onClick={executeExploreSearch}\r\n                                                disabled={!exploreFilters.activity.trim()}\r\n                                                className=\"bg-purple-600 text-white px-4 py-2 rounded font-bold hover:bg-purple-700 disabled:opacity-50\"\r\n                                            >\r\n                                                Search\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex flex-col gap-2\">\r\n                                {/* Quick Actions */}\r\n                                {selectedEvent && (\r\n                                    <div className=\"flex justify-end gap-2\">\r\n                                        <button\r\n                                            onClick={() => setWaitingForConfirmation('food_filters')}\r\n                                            className=\"text-xs font-bold text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/30 px-3 py-1 rounded-full border border-orange-200 dark:border-orange-800 hover:bg-orange-100 dark:hover:bg-orange-900/50 transition-colors flex items-center gap-1\"\r\n                                        >\r\n                                            ðŸ½ï¸ Find Food\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setWaitingForConfirmation('hotels_filters')}\r\n                                            className=\"text-xs font-bold text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-full border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors flex items-center gap-1\"\r\n                                        >\r\n                                            ðŸ¨ Find Hotels\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setWaitingForConfirmation('explore_filters')}\r\n                                            className=\"text-xs font-bold text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/30 px-3 py-1 rounded-full border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/50 transition-colors flex items-center gap-1\"\r\n                                        >\r\n                                            ðŸŽ­ Explore\r\n                                        </button>\r\n\r\n                                    </div>\r\n                                )}\r\n                                <form onSubmit={handleSubmit} className=\"flex gap-2\">\r\n                                    <input\r\n                                        className=\"flex-1 p-3 border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 shadow-sm placeholder-gray-500 dark:placeholder-gray-400\"\r\n                                        value={input}\r\n                                        placeholder=\"Type here...\"\r\n                                        onChange={(e) => setInput(e.target.value)}\r\n                                        disabled={isLoading}\r\n                                        autoFocus\r\n                                    />\r\n                                    <button\r\n                                        type=\"submit\"\r\n                                        disabled={isLoading || !input.trim()}\r\n                                        className=\"px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:bg-gray-400 dark:disabled:bg-gray-700 dark:disabled:text-gray-500 disabled:cursor-not-allowed transition-colors shadow-sm font-semibold\"\r\n                                    >\r\n                                        {isLoading ? '...' : 'Send'}\r\n                                    </button>\r\n                                </form>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT PANEL: Map View + Itinerary (Desktop) */}\r\n            <div className={`hidden lg:flex lg:flex-col w-1/2 h-full bg-gray-200 dark:bg-gray-800 border-l border-gray-300 dark:border-gray-700 transition-opacity duration-300 ease-in-out ${isSidebarOpen ? 'opacity-20 pointer-events-none' : 'opacity-100'}`}>\r\n                {/* Map Section - Takes ~60% of height */}\r\n                <div className=\"h-[60%] relative\">\r\n                    <MapView\r\n                        events={events}\r\n                        places={mapPlaces}\r\n                        selectedEvent={selectedEvent}\r\n                        selectedPlace={selectedPlace}\r\n                        itinerary={itinerary}\r\n                        onSelectPlace={handlePlaceSelect}\r\n                        isDarkMode={isDarkMode}\r\n                    />\r\n                </div>\r\n\r\n                {/* Itinerary Section - Below the map */}\r\n                <div className=\"h-[40%] overflow-y-auto bg-emerald-50 dark:bg-emerald-950 border-t border-gray-300 dark:border-gray-700\">\r\n                    {(itinerary.length > 0 || selectedEvent) ? (\r\n                        <div className=\"p-4 min-h-full\">\r\n                            <div className=\"sticky top-0 bg-emerald-50 dark:bg-emerald-950 py-2 flex justify-between items-center mb-3 z-20\">\r\n                                <h3 className=\"font-bold text-emerald-800 dark:text-emerald-200\">ðŸ“‹ Your Itinerary</h3>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={handleItinerarySubmission}\r\n                                        className=\"text-xs font-bold text-white bg-emerald-600 px-3 py-1.5 rounded-full hover:bg-emerald-700 shadow-sm transition-all flex items-center gap-1 active:scale-95\"\r\n                                    >\r\n                                        âœ¨ Generate Schedule\r\n                                    </button>\r\n                                    {schedule.length > 0 && (\r\n                                        <button\r\n                                            onClick={() => setIsScheduleOpen(true)}\r\n                                            className=\"text-xs font-bold text-emerald-700 bg-emerald-100 border border-emerald-300 px-3 py-1.5 rounded-full hover:bg-emerald-200 shadow-sm transition-all flex items-center gap-1 active:scale-95\"\r\n                                        >\r\n                                            ðŸ‘ï¸ View Schedule\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Schedule Popup Modal */}\r\n                            {isScheduleOpen && (\r\n                                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fadeIn\">\r\n                                    <div className=\"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden border border-gray-200 dark:border-gray-700\">\r\n                                        <div className=\"p-4 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50\">\r\n                                            <h3 className=\"text-xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2\">\r\n                                                ðŸ—“ï¸ Trip Schedule\r\n                                            </h3>\r\n                                            <button\r\n                                                onClick={() => setIsScheduleOpen(false)}\r\n                                                className=\"w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 text-gray-500 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors\"\r\n                                            >\r\n                                                âœ•\r\n                                            </button>\r\n                                        </div>\r\n                                        <div className=\"p-6 overflow-y-auto space-y-6\">\r\n                                            {schedule.map((item, i) => (\r\n                                                <div key={i} className=\"flex gap-4 relative\">\r\n                                                    {/* Timeline Line */}\r\n                                                    {i !== schedule.length - 1 && (\r\n                                                        <div className=\"absolute left-[93px] top-12 bottom-[-24px] w-0.5 bg-gray-200 dark:bg-gray-700\"></div>\r\n                                                    )}\r\n\r\n                                                    <div className=\"w-[85px] flex-shrink-0 text-right\">\r\n                                                        <span className=\"text-sm font-bold text-emerald-600 dark:text-emerald-400 block pt-1\">\r\n                                                            {item.time.split('-')[0].trim()}\r\n                                                        </span>\r\n                                                        <span className=\"text-xs text-gray-400\">\r\n                                                            {item.time.split('-')[1]?.trim() || ''}\r\n                                                        </span>\r\n                                                    </div>\r\n\r\n                                                    <div className=\"flex-1 bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 border border-gray-100 dark:border-gray-700 hover:border-emerald-200 dark:hover:border-emerald-800 transition-colors\">\r\n                                                        <h4 className=\"font-bold text-gray-800 dark:text-gray-100 mb-1\">{item.activity}</h4>\r\n                                                        <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed\">{item.description}</p>\r\n                                                    </div>\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                        <div className=\"p-4 border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50 text-center\">\r\n                                            <button\r\n                                                onClick={() => {\r\n                                                    setIsScheduleOpen(false);\r\n                                                    handleItinerarySubmission();\r\n                                                }}\r\n                                                className=\"text-sm font-semibold text-emerald-600 hover:text-emerald-700 flex items-center justify-center gap-2 mx-auto\"\r\n                                            >\r\n                                                â†» Regenerate Schedule\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                            <div className=\"space-y-2\">\r\n                                {selectedEvent && (\r\n                                    <div className=\"flex items-center gap-2 p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700\">\r\n                                        <span className=\"text-lg\">ðŸŽ«</span>\r\n                                        <div className=\"flex-1\">\r\n                                            <p className=\"font-semibold text-sm text-gray-800 dark:text-gray-100\">{selectedEvent.name}</p>\r\n                                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">{selectedEvent.venue}</p>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                                {itinerary.map((item, idx) => {\r\n                                    const isRestaurant = 'types' in item && !item.types.includes('lodging');\r\n                                    const isHotel = 'types' in item && (item.types.includes('lodging') || item.types.includes('hotel'));\r\n                                    const itemAsPlace = item as Place;\r\n                                    return (\r\n                                        <div key={idx} className=\"flex items-center gap-2 p-2 rounded border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700\">\r\n                                            <span className=\"text-lg\">\r\n                                                {getPlaceEmoji(item.types)}\r\n                                            </span>\r\n                                            <div className=\"flex-1\">\r\n                                                <p className=\"font-semibold text-sm text-gray-800 dark:text-gray-100\">{item.name}</p>\r\n                                                {'rating' in item && itemAsPlace.rating > 0 && (\r\n                                                    <p className=\"text-xs text-yellow-500\">\r\n                                                        {'â˜…'.repeat(Math.round(itemAsPlace.rating))}{'â˜†'.repeat(5 - Math.round(itemAsPlace.rating))}\r\n                                                        <span className=\"text-gray-400 ml-1\">({itemAsPlace.rating})</span>\r\n                                                    </p>\r\n                                                )}\r\n                                                <div className=\"flex flex-wrap gap-2 mt-1\">\r\n                                                    {isHotel && (\r\n                                                        <>\r\n                                                            <a\r\n                                                                href={`https://www.expedia.com/Hotel-Search?destination=${encodeURIComponent(item.name + ' ' + (item.address || ''))}`}\r\n                                                                target=\"_blank\"\r\n                                                                rel=\"noopener noreferrer\"\r\n                                                                className=\"inline-block bg-blue-600 text-white text-[10px] px-2 py-1 rounded hover:bg-blue-700 transition-colors\"\r\n                                                                onClick={(e) => e.stopPropagation()}\r\n                                                            >\r\n                                                                Book on Expedia â†—\r\n                                                            </a>\r\n                                                            <a\r\n                                                                href={`https://www.google.com/search?q=${encodeURIComponent(item.name + ' ' + (item.address || '') + ' reviews')}`}\r\n                                                                target=\"_blank\"\r\n                                                                rel=\"noopener noreferrer\"\r\n                                                                className=\"inline-block bg-orange-600 text-white text-[10px] px-2 py-1 rounded hover:bg-orange-700 transition-colors\"\r\n                                                                onClick={(e) => e.stopPropagation()}\r\n                                                            >\r\n                                                                Google Reviews â†—\r\n                                                            </a>\r\n                                                        </>\r\n                                                    )}\r\n                                                    {isRestaurant && (\r\n                                                        <a\r\n                                                            href={`https://www.google.com/search?q=${encodeURIComponent(item.name + ' ' + (item.address || '') + ' reviews')}`}\r\n                                                            target=\"_blank\"\r\n                                                            rel=\"noopener noreferrer\"\r\n                                                            className=\"inline-block bg-orange-600 text-white text-[10px] px-2 py-1 rounded hover:bg-orange-700 transition-colors\"\r\n                                                            onClick={(e) => e.stopPropagation()}\r\n                                                        >\r\n                                                            Google Reviews â†—\r\n                                                        </a>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            <button\r\n                                                onClick={() => removeFromItinerary(item.id)}\r\n                                                className=\"text-gray-400 hover:text-red-500 p-1\"\r\n                                                title=\"Remove from itinerary\"\r\n                                            >\r\n                                                âœ•\r\n                                            </button>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"h-full flex items-center justify-center text-gray-400\">\r\n                            <div className=\"text-center\">\r\n                                <p className=\"text-2xl mb-2\">ðŸ“‹</p>\r\n                                <p className=\"text-sm\">Your itinerary will appear here</p>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Mobile View Toggle (Optional) */}\r\n        </div>\r\n    );\r\n    // Assuming this is a functional component, the extra braces are removed.\r\n    // If it's a class component, the structure would be different.\r\n    // Based on the context (useState, etc.), it's a functional component.\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\DiamondBackground.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\DiamondBackground.tsx:36:38\n  34 |                         className=\"w-12 h-12 bg-emerald-500 rounded-xl shadow-lg transition-all duration-1000\"\n  35 |                         style={{\n> 36 |                             opacity: Math.random() * 0.4 + 0.1,\n     |                                      ^^^^^^^^^^^^^ Cannot call impure function\n  37 |                         }}\n  38 |                     />\n  39 |                 ))}","line":36,"column":38,"nodeType":null,"endLine":36,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\n\r\ninterface DiamondBackgroundProps {\r\n    className?: string;\r\n    density?: 'low' | 'high';\r\n}\r\n\r\nconst DiamondBackground: React.FC<DiamondBackgroundProps> = ({ className = \"\", density = 'high' }) => {\r\n    const rows = density === 'high' ? 8 : 4;\r\n    const cols = density === 'high' ? 12 : 6;\r\n\r\n    return (\r\n        <div className={`overflow-hidden pointer-events-none z-0 ${className}`}>\r\n            <div\r\n                style={{\r\n                    display: 'flex',\r\n                    flexWrap: 'wrap',\r\n                    gap: '12px',\r\n                    transform: 'rotate(-45deg)',\r\n                    transformOrigin: 'center',\r\n                    justifyContent: 'center',\r\n                    alignContent: 'center',\r\n                    width: '150%',\r\n                    height: '150%',\r\n                    marginLeft: '-25%',\r\n                    marginTop: '-25%',\r\n                }}\r\n            >\r\n                {Array.from({ length: rows * cols }).map((_, i) => (\r\n                    <div\r\n                        key={i}\r\n                        className=\"w-12 h-12 bg-emerald-500 rounded-xl shadow-lg transition-all duration-1000\"\r\n                        style={{\r\n                            opacity: Math.random() * 0.4 + 0.1,\r\n                        }}\r\n                    />\r\n                ))}\r\n            </div>\r\n            {/* Soft fade edges */}\r\n            <div className=\"absolute inset-0 bg-gradient-to-t from-white/20 via-transparent to-white/20 dark:from-gray-900/20 dark:to-gray-900/20\" />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DiamondBackground;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\GopherLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\LoginNavbar.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\LoginNavbar.tsx:12:9\n  10 |\n  11 |     useEffect(() => {\n> 12 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  13 |         // Initialize theme from localStorage or system pref\n  14 |         const savedTheme = localStorage.getItem('theme');\n  15 |         const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","line":12,"column":9,"nodeType":null,"endLine":12,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { signIn } from \"next-auth/react\";\r\n\r\nexport default function LoginNavbar() {\r\n    const [isDarkMode, setIsDarkMode] = useState(false);\r\n    const [mounted, setMounted] = useState(false);\r\n    const [showLogo, setShowLogo] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        // Initialize theme from localStorage or system pref\r\n        const savedTheme = localStorage.getItem('theme');\r\n        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n\r\n        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {\r\n            setIsDarkMode(true);\r\n            document.documentElement.classList.add('dark');\r\n        } else {\r\n            setIsDarkMode(false);\r\n            document.documentElement.classList.remove('dark');\r\n        }\r\n\r\n        // Scroll handler to show/hide logo\r\n        const handleScroll = () => {\r\n            // Show logo when scrolled past 200px (approximately where big logo would be)\r\n            setShowLogo(window.scrollY > 200);\r\n        };\r\n\r\n        window.addEventListener('scroll', handleScroll);\r\n        return () => window.removeEventListener('scroll', handleScroll);\r\n    }, []);\r\n\r\n    const toggleTheme = () => {\r\n        setIsDarkMode(prev => {\r\n            const newMode = !prev;\r\n            if (newMode) {\r\n                document.documentElement.classList.add('dark');\r\n                localStorage.setItem('theme', 'dark');\r\n            } else {\r\n                document.documentElement.classList.remove('dark');\r\n                localStorage.setItem('theme', 'light');\r\n            }\r\n            return newMode;\r\n        });\r\n    };\r\n\r\n    if (!mounted) return null;\r\n\r\n    return (\r\n        <nav className=\"sticky top-0 w-full bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 h-16 flex items-center justify-between px-4 shrink-0 z-50 shadow-sm transition-all duration-300\">\r\n            {/* Empty left side for balance */}\r\n            <div className=\"w-24\"></div>\r\n\r\n            {/* Center Logo - Only visible when scrolled */}\r\n            <h1\r\n                className={`text-3xl font-extrabold tracking-tighter bg-gradient-to-r from-emerald-300 to-emerald-600 bg-clip-text text-transparent font-mono transition-all duration-300 ${showLogo ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4 pointer-events-none'}`}\r\n            >\r\n                gopher\r\n            </h1>\r\n\r\n            {/* Right side - Debug, Theme toggle and Sign In */}\r\n            <div className=\"flex items-center gap-2\">\r\n                {/* Debug Login Button */}\r\n                <button\r\n                    onClick={() => signIn('credentials', { callbackUrl: '/' })}\r\n                    className=\"p-2 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 transition-colors\"\r\n                    title=\"Log in as Debug User\"\r\n                >\r\n                    {/* Bug icon */}\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\r\n                    </svg>\r\n                </button>\r\n\r\n                {/* Theme Toggle */}\r\n                <button\r\n                    onClick={toggleTheme}\r\n                    className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-300 transition-colors\"\r\n                    title={isDarkMode ? \"Switch to Light Mode\" : \"Switch to Dark Mode\"}\r\n                >\r\n                    {isDarkMode ? (\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n                        </svg>\r\n                    ) : (\r\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n                        </svg>\r\n                    )}\r\n                </button>\r\n\r\n                {/* Sign In Button */}\r\n                <button\r\n                    onClick={() => signIn('google', { callbackUrl: '/' })}\r\n                    className=\"p-2 rounded-lg hover:bg-emerald-50 dark:hover:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 transition-colors\"\r\n                    title=\"Sign In with Google\"\r\n                >\r\n                    {/* Login/Arrow icon */}\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1\" />\r\n                    </svg>\r\n                </button>\r\n            </div>\r\n        </nav>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\MapView.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[248,251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[248,251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[269,272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[269,272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[297,300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[297,300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[359,362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[359,362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[397,400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[397,400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4858,4861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4858,4861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { importLibrary, setOptions } from '@googlemaps/js-api-loader';\r\n\r\ninterface MapViewProps {\r\n    center?: { lat: number; lng: number };\r\n    zoom?: number;\r\n    events?: any[];\r\n    places?: any[];\r\n    selectedEvent?: any | null;\r\n    selectedPlace?: any | null;\r\n    itinerary?: any[];\r\n\r\n    onSelectPlace?: (place: any) => void;\r\n    isDarkMode?: boolean;\r\n}\r\n\r\nconst darkMapStyles = [\r\n    { elementType: \"geometry\", stylers: [{ color: \"#242f3e\" }] },\r\n    { elementType: \"labels.text.stroke\", stylers: [{ color: \"#242f3e\" }] },\r\n    { elementType: \"labels.text.fill\", stylers: [{ color: \"#746855\" }] },\r\n    {\r\n        featureType: \"administrative.locality\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#d59563\" }],\r\n    },\r\n    {\r\n        featureType: \"poi\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#d59563\" }],\r\n    },\r\n    {\r\n        featureType: \"poi.park\",\r\n        elementType: \"geometry\",\r\n        stylers: [{ color: \"#263c3f\" }],\r\n    },\r\n    {\r\n        featureType: \"poi.park\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#6b9a76\" }],\r\n    },\r\n    {\r\n        featureType: \"road\",\r\n        elementType: \"geometry\",\r\n        stylers: [{ color: \"#38414e\" }],\r\n    },\r\n    {\r\n        featureType: \"road\",\r\n        elementType: \"geometry.stroke\",\r\n        stylers: [{ color: \"#212a37\" }],\r\n    },\r\n    {\r\n        featureType: \"road\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#9ca5b3\" }],\r\n    },\r\n    {\r\n        featureType: \"road.highway\",\r\n        elementType: \"geometry\",\r\n        stylers: [{ color: \"#746855\" }],\r\n    },\r\n    {\r\n        featureType: \"road.highway\",\r\n        elementType: \"geometry.stroke\",\r\n        stylers: [{ color: \"#1f2835\" }],\r\n    },\r\n    {\r\n        featureType: \"road.highway\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#f3d19c\" }],\r\n    },\r\n    {\r\n        featureType: \"transit\",\r\n        elementType: \"geometry\",\r\n        stylers: [{ color: \"#2f3948\" }],\r\n    },\r\n    {\r\n        featureType: \"transit.station\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#d59563\" }],\r\n    },\r\n    {\r\n        featureType: \"water\",\r\n        elementType: \"geometry\",\r\n        stylers: [{ color: \"#17263c\" }],\r\n    },\r\n    {\r\n        featureType: \"water\",\r\n        elementType: \"labels.text.fill\",\r\n        stylers: [{ color: \"#515c6d\" }],\r\n    },\r\n    {\r\n        featureType: \"water\",\r\n        elementType: \"labels.text.stroke\",\r\n        stylers: [{ color: \"#17263c\" }],\r\n    },\r\n];\r\n\r\nexport default function MapView({\r\n    center = { lat: 34.0522, lng: -118.2437 },\r\n    zoom = 12,\r\n    events = [],\r\n    places = [],\r\n    selectedEvent = null,\r\n    selectedPlace = null,\r\n    itinerary = [],\r\n    onSelectPlace,\r\n    isDarkMode = false\r\n}: MapViewProps) {\r\n    const mapRef = useRef<HTMLDivElement>(null);\r\n    const [map, setMap] = useState<google.maps.Map | null>(null);\r\n    const markersRef = useRef<google.maps.Marker[]>([]);\r\n\r\n    useEffect(() => {\r\n        const initMap = async () => {\r\n            // Configure the loader\r\n            setOptions({\r\n                apiKey: process.env.NEXT_PUBLIC_GOOGLE_API_KEY as string,\r\n                version: 'weekly',\r\n                libraries: ['places']\r\n            });\r\n\r\n            try {\r\n                // Import the Maps library using the functional API\r\n                const { Map } = await importLibrary('maps') as google.maps.MapsLibrary;\r\n\r\n                // Use selected event location if available, otherwise default center\r\n                const initialCenter = selectedEvent?.location || center;\r\n\r\n                const newMap = new Map(mapRef.current as HTMLElement, {\r\n                    center: initialCenter,\r\n                    zoom: zoom,\r\n                    // mapId: 'DEMO_MAP_ID', // Removed to fix ApiProjectMapError\r\n                    disableDefaultUI: false,\r\n                    zoomControl: true,\r\n                    streetViewControl: false,\r\n                });\r\n\r\n                setMap(newMap);\r\n            } catch (error) {\r\n                console.error('Error loading Google Maps:', error);\r\n            }\r\n        };\r\n\r\n        if (!map) {\r\n            initMap();\r\n        } else {\r\n            map.setOptions({ styles: isDarkMode ? darkMapStyles : null });\r\n        }\r\n    }, [map, center, zoom, selectedEvent, isDarkMode]);\r\n\r\n    // Update markers when data changes\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        // Clear existing markers\r\n        markersRef.current.forEach(marker => marker.setMap(null));\r\n        markersRef.current = [];\r\n\r\n        const bounds = new google.maps.LatLngBounds();\r\n        let hasPoints = false;\r\n\r\n        const addMarker = (item: any, title: string, type: 'event' | 'place' | 'itinerary' | 'selected', isSelected: boolean = false) => {\r\n            const position = item.location;\r\n            if (!position || !position.lat || !position.lng) return;\r\n\r\n            // COLOR LOGIC (Tailwind-ish Hex Colors):\r\n            // Event = Red-500 (#EF4444)\r\n            // Selected Place = Green-500 (#22C55E)\r\n            // Place = Blue-500 (#3B82F6)\r\n            // Itinerary = Purple-900 (#581c87) - DARKER PURPLE\r\n\r\n            let color = '#3B82F6'; // Default Blue\r\n\r\n            if (type === 'event' || type === 'selected') {\r\n                color = '#EF4444'; // Red\r\n            }\r\n            if (type === 'itinerary') {\r\n                color = '#EF4444'; // Red (User Request: \"thing on the itinerary should all be red\")\r\n            }\r\n            if (isSelected) {\r\n                color = '#22C55E'; // Green\r\n            }\r\n\r\n            // SVG Paths\r\n            const pinPath = \"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\";\r\n            const foodPath = \"M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z\"; // Fork & Knife\r\n            const hotelPath = \"M7 13c1.66 0 3-1.34 3-3S8.66 7 7 7s-3 1.34-3 3 1.34 3 3 3zm12-6h-8v7H3V5H1v15h2v-3h18v3h2v-9c0-2.21-1.79-4-4-4z\"; // Bed\r\n\r\n            // Determine Path based on Type\r\n            let path = pinPath;\r\n            if (item.types && (item.types.includes('restaurant') || item.types.includes('food') || item.types.includes('meal_takeaway'))) {\r\n                path = foodPath;\r\n            } else if (item.types && (item.types.includes('lodging') || item.types.includes('hotel'))) {\r\n                path = hotelPath;\r\n            }\r\n\r\n            const icon: google.maps.Symbol = {\r\n                path: path,\r\n                fillColor: color,\r\n                fillOpacity: 1,\r\n                strokeWeight: 1,\r\n                strokeColor: '#FFFFFF',\r\n                anchor: path === pinPath ? new google.maps.Point(12, 22) : new google.maps.Point(12, 12), // Adjust anchor for square icons\r\n                scale: isSelected ? 1.5 : 1.2, // Slightly smaller scale for complex icons\r\n            };\r\n\r\n            const marker = new google.maps.Marker({\r\n                position,\r\n                map,\r\n                title,\r\n                icon: icon,\r\n                zIndex: isSelected ? 999 : 1,\r\n                animation: google.maps.Animation.DROP\r\n            });\r\n\r\n            // Add click listener\r\n            if (type === 'place' && onSelectPlace) {\r\n                marker.addListener('click', () => {\r\n                    onSelectPlace(item);\r\n                });\r\n            }\r\n\r\n            markersRef.current.push(marker);\r\n            bounds.extend(position);\r\n            hasPoints = true;\r\n        };\r\n\r\n        // 1. Add Selected Event\r\n        if (selectedEvent && selectedEvent.location) {\r\n            addMarker(selectedEvent, `event: ${selectedEvent.name}`, 'event');\r\n        }\r\n\r\n        // 2. Add Itinerary Items\r\n        itinerary.forEach(item => {\r\n            addMarker(item, `Itinerary: ${item.name}`, 'itinerary');\r\n        });\r\n\r\n        // 3. Add Search Results\r\n        // Events\r\n        if (!selectedEvent && events.length > 0) {\r\n            events.forEach(event => {\r\n                addMarker(event, event.name, 'event');\r\n            });\r\n        }\r\n\r\n        // Places\r\n        if (places.length > 0) {\r\n            places.forEach(place => {\r\n                const isSelected = selectedPlace?.id === place.id;\r\n                addMarker(place, place.name, 'place', isSelected);\r\n            });\r\n        }\r\n\r\n        // Fit bounds\r\n        if (hasPoints) {\r\n            map.fitBounds(bounds);\r\n        } else if (selectedEvent?.location) {\r\n            map.setCenter(selectedEvent.location);\r\n            map.setZoom(14);\r\n        }\r\n\r\n    }, [map, events, places, selectedEvent, selectedPlace, itinerary, onSelectPlace]);\r\n\r\n    return (\r\n        <div className=\"w-full h-full overflow-hidden relative bg-gray-100\">\r\n            <div ref={mapRef} className=\"w-full h-full min-h-[400px]\" />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\Sidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signOut' is defined but never used.","line":2,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"signOut"},"fix":{"range":[80,89],"text":""},"desc":"Remove unused variable \"signOut\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":3,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[116,144],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadLocalSessions' is assigned a value but never used.","line":48,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":48,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":60,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":60,"endColumn":23},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\Sidebar.tsx:99:13\n   97 |\n   98 |         if (isOpen) {\n>  99 |             loadSessions();\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  100 |         }\n  101 |\n  102 |         return () => window.removeEventListener('storage', handleStorageChange);","line":99,"column":13,"nodeType":null,"endLine":99,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadSessions'. Either include it or remove the dependency array.","line":103,"column":8,"nodeType":"ArrayExpression","endLine":103,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, loadSessions, session, status]","fix":{"range":[3706,3731],"text":"[isOpen, loadSessions, session, status]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\Sidebar.tsx:107:13\n  105 |     useEffect(() => {\n  106 |         if (status === 'unauthenticated') {\n> 107 |             setSessions([]);\n      |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  108 |         }\n  109 |     }, [status]);\n  110 |","line":107,"column":13,"nodeType":null,"endLine":107,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useRef } from 'react';\r\nimport { useSession, signOut } from \"next-auth/react\"\r\nimport Link from 'next/link'\r\nimport { getChats, deleteChat, renameChat, togglePinChat } from \"@/app/actions\"\r\n\r\ninterface ChatSession {\r\n    id: string;\r\n    preview: string;\r\n    timestamp: number;\r\n    isPinned?: boolean;\r\n}\r\n\r\ninterface SidebarProps {\r\n    isOpen: boolean;\r\n    currentSessionId: string;\r\n    onSelectSession: (id: string) => void;\r\n    onNewChat: () => void;\r\n    onViewSchedule: (id: string) => void;\r\n}\r\n\r\nconst Sidebar: React.FC<SidebarProps> = ({ isOpen, currentSessionId, onSelectSession, onNewChat, onViewSchedule }) => {\r\n    const { data: session, status } = useSession()\r\n    const [sessions, setSessions] = useState<ChatSession[]>([]);\r\n    const [activeMenuId, setActiveMenuId] = useState<string | null>(null);\r\n    const [editingId, setEditingId] = useState<string | null>(null);\r\n    const [editName, setEditName] = useState('');\r\n    const menuRef = useRef<HTMLDivElement>(null);\r\n    const editInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Close menu when clicking outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n                setActiveMenuId(null);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    // Focus input when editing starts\r\n    useEffect(() => {\r\n        if (editingId && editInputRef.current) {\r\n            editInputRef.current.focus();\r\n        }\r\n    }, [editingId]);\r\n\r\n    const loadLocalSessions = () => {\r\n        const allKeys = Object.keys(localStorage);\r\n        const sessionKeys = allKeys.filter(k => k.startsWith('chat_session_'));\r\n        const loadedSessions = sessionKeys.map(key => {\r\n            try {\r\n                const data = JSON.parse(localStorage.getItem(key) || '{}');\r\n                return {\r\n                    id: key.replace('chat_session_', ''),\r\n                    preview: data.preview || 'New Chat',\r\n                    timestamp: data.timestamp || 0,\r\n                    isPinned: data.isPinned || false\r\n                };\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n        }).filter(Boolean) as ChatSession[];\r\n\r\n        loadedSessions.sort((a, b) => {\r\n            if (a.isPinned !== b.isPinned) return a.isPinned ? -1 : 1;\r\n            return b.timestamp - a.timestamp;\r\n        });\r\n        setSessions(loadedSessions);\r\n    };\r\n\r\n    const loadSessions = async () => {\r\n        if (session?.user) {\r\n            const dbChats = await getChats();\r\n            setSessions(dbChats);\r\n        } else {\r\n            // If logged out (or pure guest mode), clear any potentially stale DB sessions first\r\n            // But wait, if guest mode is intended, we should load local storage.\r\n            // The issue is transition.\r\n\r\n            // Explicitly clearer logic:\r\n            if (status === 'unauthenticated') {\r\n                // Pure guest mode - load local storage\r\n                // loadLocalSessions(); \r\n            } else if (status === 'loading') {\r\n                // Do nothing, wait\r\n            }\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const handleStorageChange = () => {\r\n            loadSessions();\r\n        };\r\n\r\n        window.addEventListener('storage', handleStorageChange);\r\n\r\n        if (isOpen) {\r\n            loadSessions();\r\n        }\r\n\r\n        return () => window.removeEventListener('storage', handleStorageChange);\r\n    }, [isOpen, session, status]);\r\n\r\n    useEffect(() => {\r\n        if (status === 'unauthenticated') {\r\n            setSessions([]);\r\n        }\r\n    }, [status]);\r\n\r\n    const handleDelete = async (e: React.MouseEvent, id: string) => {\r\n        e.stopPropagation();\r\n\r\n        if (session?.user) {\r\n            await deleteChat(id);\r\n            await loadSessions();\r\n        } else {\r\n            localStorage.removeItem(`chat_session_${id}`);\r\n            loadSessions();\r\n        }\r\n\r\n        if (id === currentSessionId) {\r\n            onNewChat();\r\n        }\r\n        setActiveMenuId(null);\r\n    };\r\n\r\n    const handlePin = async (e: React.MouseEvent, id: string, currentPinned: boolean) => {\r\n        e.stopPropagation();\r\n\r\n        if (session?.user) {\r\n            await togglePinChat(id, !currentPinned);\r\n            await loadSessions();\r\n        } else {\r\n            const key = `chat_session_${id}`;\r\n            const data = JSON.parse(localStorage.getItem(key) || '{}');\r\n            data.isPinned = !currentPinned;\r\n            localStorage.setItem(key, JSON.stringify(data));\r\n            loadSessions();\r\n        }\r\n        setActiveMenuId(null);\r\n    };\r\n\r\n    const startRenaming = (e: React.MouseEvent, session: ChatSession) => {\r\n        e.stopPropagation();\r\n        setEditingId(session.id);\r\n        setEditName(session.preview);\r\n        setActiveMenuId(null);\r\n    };\r\n\r\n    const saveRename = async () => {\r\n        if (!editingId) return;\r\n\r\n        if (session?.user) {\r\n            await renameChat(editingId, editName.trim() || 'Untitled Chat');\r\n            await loadSessions();\r\n        } else {\r\n            const key = `chat_session_${editingId}`;\r\n            const data = JSON.parse(localStorage.getItem(key) || '{}');\r\n            data.preview = editName.trim() || 'Untitled Chat';\r\n            localStorage.setItem(key, JSON.stringify(data));\r\n            loadSessions();\r\n        }\r\n        setEditingId(null);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (e.key === 'Enter') saveRename();\r\n        if (e.key === 'Escape') setEditingId(null);\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className={`fixed top-0 left-0 h-full bg-emerald-900 dark:bg-gray-950 text-white w-80 shadow-2xl transform transition-transform duration-300 ease-in-out z-40 ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}\r\n            style={{ paddingTop: '5rem' }}\r\n        >\r\n            <div className=\"p-4 flex flex-col h-full\">\r\n                <button\r\n                    onClick={onNewChat}\r\n                    className=\"w-full bg-emerald-600 hover:bg-emerald-500 dark:bg-emerald-800 dark:hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors mb-6 shadow-md\"\r\n                >\r\n                    <span className=\"text-xl leading-none mb-1\">+</span> New Chat\r\n                </button>\r\n\r\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar pb-20\">\r\n                    <h3 className=\"text-xs font-bold text-emerald-400 uppercase tracking-wider mb-3\">Recent Chats</h3>\r\n                    <div className=\"space-y-2\">\r\n                        {sessions.length === 0 && (\r\n                            <p className=\"text-emerald-500/50 text-sm italic p-2\">No history yet.</p>\r\n                        )}\r\n                        {sessions.map(session => (\r\n                            <div key={session.id} className=\"relative group\">\r\n                                {editingId === session.id ? (\r\n                                    <div className=\"flex items-center px-2 py-2 bg-emerald-800 rounded\">\r\n                                        <input\r\n                                            ref={editInputRef}\r\n                                            value={editName}\r\n                                            onChange={(e) => setEditName(e.target.value)}\r\n                                            onBlur={saveRename}\r\n                                            onKeyDown={handleKeyDown}\r\n                                            className=\"w-full bg-transparent text-white focus:outline-none text-sm\"\r\n                                        />\r\n                                    </div>\r\n                                ) : (\r\n                                    <button\r\n                                        onClick={() => onSelectSession(session.id)}\r\n                                        className={`w-full text-left p-3 pr-8 rounded-lg text-sm transition-all truncate flex justify-between items-center ${currentSessionId === session.id ? 'bg-emerald-800 dark:bg-gray-800 text-white font-semibold border-l-4 border-emerald-400' : 'text-emerald-100 dark:text-gray-400 hover:bg-emerald-800/50 dark:hover:bg-gray-900/50'}`}\r\n                                    >\r\n                                        <span className=\"truncate flex-1 flex items-center gap-2\">\r\n                                            {session.isPinned && <span>ðŸ“Œ</span>}\r\n                                            {session.preview}\r\n                                        </span>\r\n\r\n                                        {/* Three Dots Menu Button */}\r\n                                        <div\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                setActiveMenuId(activeMenuId === session.id ? null : session.id);\r\n                                            }}\r\n                                            className=\"absolute right-2 p-1 text-gray-400 hover:text-white rounded hover:bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                        >\r\n                                            â‹®\r\n                                        </div>\r\n\r\n                                    </button>\r\n                                )}\r\n\r\n                                {/* Dropdown Menu */}\r\n                                {activeMenuId === session.id && (\r\n                                    <div\r\n                                        ref={menuRef}\r\n                                        className=\"absolute right-0 top-8 w-32 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 overflow-hidden border border-gray-200 dark:border-gray-700 animate-fadeIn\"\r\n                                    >\r\n                                        <button\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                onViewSchedule(session.id);\r\n                                                setActiveMenuId(null);\r\n                                            }}\r\n                                            className=\"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                        >\r\n                                            Schedule\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={(e) => handlePin(e, session.id, !!session.isPinned)}\r\n                                            className=\"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                        >\r\n                                            {session.isPinned ? 'Unpin' : 'Pin'}\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={(e) => startRenaming(e, session)}\r\n                                            className=\"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                        >\r\n                                            Rename\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={(e) => handleDelete(e, session.id)}\r\n                                            className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2 border-t border-gray-100 dark:border-gray-700\"\r\n                                        >\r\n                                            Delete\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Footer with User Profile */}\r\n                {/* Auth controls moved to Navbar as per request, just showing profile if desired or empty */}\r\n                <div className=\"pt-4 mt-auto border-t border-emerald-800/50 dark:border-gray-800\">\r\n                    {session?.user ? (\r\n                        <div className=\"flex items-center gap-3 px-2 pb-2\">\r\n                            {/* Just show who is logged in context, but no buttons */}\r\n                            <div className=\"w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-xs text-white font-bold\">\r\n                                {session.user.name?.[0] || 'U'}\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-sm font-medium truncate text-emerald-100\">{session.user.name}</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"px-2 pb-2 text-xs text-emerald-500/50 text-center\">\r\n                            Guest Mode\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Sidebar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\ThemeToggle.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\components\\ThemeToggle.tsx:10:9\n   8 |\n   9 |     useEffect(() => {\n> 10 |         setMounted(true);\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  11 |         // Initialize theme from localStorage or system pref\n  12 |         const savedTheme = localStorage.getItem('theme');\n  13 |         const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;","line":10,"column":9,"nodeType":null,"endLine":10,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useState } from 'react';\r\n\r\nexport default function ThemeToggle() {\r\n    const [isDarkMode, setIsDarkMode] = useState(false);\r\n    const [mounted, setMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setMounted(true);\r\n        // Initialize theme from localStorage or system pref\r\n        const savedTheme = localStorage.getItem('theme');\r\n        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n\r\n        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {\r\n            setIsDarkMode(true);\r\n            document.documentElement.classList.add('dark');\r\n        } else {\r\n            setIsDarkMode(false);\r\n            document.documentElement.classList.remove('dark');\r\n        }\r\n    }, []);\r\n\r\n    const toggleTheme = () => {\r\n        setIsDarkMode(prev => {\r\n            const newMode = !prev;\r\n            if (newMode) {\r\n                document.documentElement.classList.add('dark');\r\n                localStorage.setItem('theme', 'dark');\r\n            } else {\r\n                document.documentElement.classList.remove('dark');\r\n                localStorage.setItem('theme', 'light');\r\n            }\r\n            return newMode;\r\n        });\r\n    };\r\n\r\n    if (!mounted) return null;\r\n\r\n    return (\r\n        <button\r\n            onClick={toggleTheme}\r\n            className=\"p-3 rounded-full bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 text-gray-800 dark:text-white transition-all shadow-lg\"\r\n            title={isDarkMode ? \"Switch to Light Mode\" : \"Switch to Dark Mode\"}\r\n            aria-label=\"Toggle Dark Mode\"\r\n        >\r\n            {isDarkMode ? (\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n                </svg>\r\n            ) : (\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n                </svg>\r\n            )}\r\n        </button>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\db\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\db\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\gurus\\OneDrive\\Desktop\\gopher\\gopher\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]